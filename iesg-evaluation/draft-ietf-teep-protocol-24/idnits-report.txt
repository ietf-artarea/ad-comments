idnits 2.17.1 

draft-ietf-teep-protocol-24.txt:

  Showing Errors (**), Flaws (~~), Warnings (==), and Comments (--).
  Errors MUST be fixed before draft submission.  Flaws SHOULD be fixed before draft submission.

  Checking boilerplate required by RFC 5378 and the IETF Trust (see
  https://trustee.ietf.org/license-info):
  ----------------------------------------------------------------------------

     No issues found here.

  Checking nits according to https://www.ietf.org/id-info/1id-guidelines.txt:
  ----------------------------------------------------------------------------

  == There are 3 instances of lines with non-ascii characters in the document.


  Running in submission checking mode -- *not* checking nits according to
  https://www.ietf.org/id-info/checklist .
  ----------------------------------------------------------------------------


     Summary: 0 errors (**), 0 flaws (~~), 1 warning (==), 0 comments (--).

--------------------------------------------------------------------------------


2	TEEP                                                       H. Tschofenig
3	Internet-Draft                                                     H-BRS
4	Intended status: Standards Track                                  M. Pei
5	Expires: 15 August 2026                                         Broadcom
6	                                                              D. Wheeler
7	                                                                  Amazon
8	                                                               D. Thaler
9	                                                               Microsoft
10	                                                            A. Tsukamoto
11	                                  Openchip & Software Technologies, S.L.
12	                                                        11 February 2026

14	       Trusted Execution Environment Provisioning (TEEP) Protocol
15	                      draft-ietf-teep-protocol-24

17	Abstract

19	   This document specifies a protocol that installs, updates, and
20	   deletes Trusted Components in a device with a Trusted Execution
21	   Environment (TEE).  This specification defines an interoperable
22	   protocol for managing the lifecycle of Trusted Components.

24	Status of This Memo

26	   This Internet-Draft is submitted in full conformance with the
27	   provisions of BCP 78 and BCP 79.

29	   Internet-Drafts are working documents of the Internet Engineering
30	   Task Force (IETF).  Note that other groups may also distribute
31	   working documents as Internet-Drafts.  The list of current Internet-
32	   Drafts is at https://datatracker.ietf.org/drafts/current/.

34	   Internet-Drafts are draft documents valid for a maximum of six months
35	   and may be updated, replaced, or obsoleted by other documents at any
36	   time.  It is inappropriate to use Internet-Drafts as reference
37	   material or to cite them other than as "work in progress."

39	   This Internet-Draft will expire on 15 August 2026.

41	Copyright Notice

43	   Copyright (c) 2026 IETF Trust and the persons identified as the
44	   document authors.  All rights reserved.

46	   This document is subject to BCP 78 and the IETF Trust's Legal
47	   Provisions Relating to IETF Documents (https://trustee.ietf.org/
48	   license-info) in effect on the date of publication of this document.
49	   Please review these documents carefully, as they describe your rights
50	   and restrictions with respect to this document.  Code Components
51	   extracted from this document must include Revised BSD License text as
52	   described in Section 4.e of the Trust Legal Provisions and are
53	   provided without warranty as described in the Revised BSD License.

55	Table of Contents

57	   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   4
58	   2.  Terminology . . . . . . . . . . . . . . . . . . . . . . . . .   4
59	   3.  Message Overview  . . . . . . . . . . . . . . . . . . . . . .   5
60	   4.  Detailed Messages Specification . . . . . . . . . . . . . . .   6
61	     4.1.  Creating and Validating TEEP Messages . . . . . . . . . .   7
62	       4.1.1.  Creating a TEEP message . . . . . . . . . . . . . . .   7
63	       4.1.2.  Validating a TEEP Message . . . . . . . . . . . . . .   8
64	     4.2.  QueryRequest Message  . . . . . . . . . . . . . . . . . .   8
65	     4.3.  QueryResponse Message . . . . . . . . . . . . . . . . . .  12
66	       4.3.1.  Evidence and Attestation Results  . . . . . . . . . .  15
67	     4.4.  Update Message  . . . . . . . . . . . . . . . . . . . . .  17
68	       4.4.1.  Scenario 1: Having one SUIT Manifest pointing to a URI
69	               of a Trusted Component Binary . . . . . . . . . . . .  20
70	       4.4.2.  Scenario 2: Having a SUIT Manifest include the Trusted
71	               Component Binary  . . . . . . . . . . . . . . . . . .  23
72	       4.4.3.  Scenario 3: Supplying Personalization Data for the
73	               Trusted Component Binary  . . . . . . . . . . . . . .  24
74	     4.5.  Success Message . . . . . . . . . . . . . . . . . . . . .  27
75	     4.6.  Error Message . . . . . . . . . . . . . . . . . . . . . .  28
76	   5.  EAT Profile . . . . . . . . . . . . . . . . . . . . . . . . .  33
77	     5.1.  Relationship to AR4SI . . . . . . . . . . . . . . . . . .  35
78	   6.  Mapping of TEEP Message Parameters to CBOR Labels . . . . . .  36
79	   7.  Behavior Specification  . . . . . . . . . . . . . . . . . . .  38
80	     7.1.  TAM Behavior  . . . . . . . . . . . . . . . . . . . . . .  38
81	       7.1.1.  Handling a QueryResponse Message  . . . . . . . . . .  39
82	         7.1.1.1.  Handling an Attestation Result  . . . . . . . . .  39
83	       7.1.2.  Handling a Success or Error Message . . . . . . . . .  41
84	     7.2.  TEEP Agent Behavior . . . . . . . . . . . . . . . . . . .  41
85	       7.2.1.  Handling a QueryRequest Message . . . . . . . . . . .  42
86	         7.2.1.1.  Handling an Attestation Result  . . . . . . . . .  43
87	       7.2.2.  Handling an Update Message  . . . . . . . . . . . . .  43
88	   8.  Cipher Suites . . . . . . . . . . . . . . . . . . . . . . . .  43
89	     8.1.  TEEP Messages . . . . . . . . . . . . . . . . . . . . . .  44
90	     8.2.  EATs and SUIT Reports . . . . . . . . . . . . . . . . . .  46
91	   9.  Attestation Freshness Mechanisms  . . . . . . . . . . . . . .  48
92	   10. Security Considerations . . . . . . . . . . . . . . . . . . .  49
93	     10.1.  Operational Considerations . . . . . . . . . . . . . . .  51
94	   11. Transport Considerations  . . . . . . . . . . . . . . . . . .  53
95	   12. Privacy Considerations  . . . . . . . . . . . . . . . . . . .  54
96	   13. IANA Considerations . . . . . . . . . . . . . . . . . . . . .  54
97	     13.1.  Media Type Registration  . . . . . . . . . . . . . . . .  54
98	     13.2.  TEEP Message Type Registry . . . . . . . . . . . . . . .  55
99	     13.3.  data-item-requested Bitmap Registry  . . . . . . . . . .  56
100	     13.4.  TEEP Error Code Registry . . . . . . . . . . . . . . . .  57
101	     13.5.  TEEP CBOR Label Registry . . . . . . . . . . . . . . . .  59
102	     13.6.  TEEP Cipher Suite Registry . . . . . . . . . . . . . . .  61
103	     13.7.  TEEP Freshness Mechanism Registry  . . . . . . . . . . .  61
104	   14. References  . . . . . . . . . . . . . . . . . . . . . . . . .  62
105	     14.1.  Normative References . . . . . . . . . . . . . . . . . .  62
106	     14.2.  Informative References . . . . . . . . . . . . . . . . .  64
107	   A.  Contributors  . . . . . . . . . . . . . . . . . . . . . . . .  66
108	   B.  Acknowledgements  . . . . . . . . . . . . . . . . . . . . . .  66
109	   C.  Complete CDDL . . . . . . . . . . . . . . . . . . . . . . . .  66
110	   D.  Examples of Diagnostic Notation and Binary Representation . .  71
111	     D.1.  QueryRequest Message  . . . . . . . . . . . . . . . . . .  71
112	       D.1.1.  CBOR Diagnostic Notation  . . . . . . . . . . . . . .  71
113	       D.1.2.  CBOR Binary Representation  . . . . . . . . . . . . .  72
114	     D.2.  Entity Attestation Token  . . . . . . . . . . . . . . . .  74
115	       D.2.1.  CBOR Diagnostic Notation  . . . . . . . . . . . . . .  74
116	     D.3.  QueryResponse Message . . . . . . . . . . . . . . . . . .  74
117	       D.3.1.  CBOR Diagnostic Notation  . . . . . . . . . . . . . .  74
118	       D.3.2.  CBOR Binary Representation  . . . . . . . . . . . . .  75
119	     D.4.  Update Message  . . . . . . . . . . . . . . . . . . . . .  76
120	       D.4.1.  CBOR Diagnostic Notation  . . . . . . . . . . . . . .  76
121	       D.4.2.  CBOR Binary Representation  . . . . . . . . . . . . .  78
122	     D.5.  Success Message . . . . . . . . . . . . . . . . . . . . .  79
123	       D.5.1.  CBOR Diagnostic Notation  . . . . . . . . . . . . . .  79
124	       D.5.2.  CBOR Binary Representation  . . . . . . . . . . . . .  79
125	     D.6.  Error Message . . . . . . . . . . . . . . . . . . . . . .  79
126	       D.6.1.  CBOR Diagnostic Notation  . . . . . . . . . . . . . .  79
127	       D.6.2.  CBOR binary Representation  . . . . . . . . . . . . .  79
128	   E.  Examples of SUIT Manifests  . . . . . . . . . . . . . . . . .  80
129	     Example 1: SUIT Manifest pointing to URI of the Trusted Component
130	             Binary  . . . . . . . . . . . . . . . . . . . . . . . .  80
131	       CBOR Diagnostic Notation of SUIT Manifest . . . . . . . . . .  80
132	       CBOR Binary in Hex  . . . . . . . . . . . . . . . . . . . . .  82
133	     Example 2: SUIT Manifest including the Trusted Component
134	             Binary  . . . . . . . . . . . . . . . . . . . . . . . .  82
135	       CBOR Diagnostic Notation of SUIT Manifest . . . . . . . . . .  82
136	       CBOR Binary in Hex  . . . . . . . . . . . . . . . . . . . . .  84
137	     Example 3: Supplying Personalization Data for Trusted Component
138	             Binary  . . . . . . . . . . . . . . . . . . . . . . . .  84
139	       CBOR Diagnostic Notation of SUIT Manifest . . . . . . . . . .  85
140	       CBOR Binary in Hex  . . . . . . . . . . . . . . . . . . . . .  88
141	   F.  Examples of SUIT Reports  . . . . . . . . . . . . . . . . . .  88
142	     F.1.  Example 1: Success  . . . . . . . . . . . . . . . . . . .  88
143	     F.2.  Example 2: Failure  . . . . . . . . . . . . . . . . . . .  89
144	   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  90

146	1.  Introduction

148	   The Trusted Execution Environment (TEE) concept has been designed to
149	   separate a regular operating system, also referred to as a Rich
150	   Execution Environment (REE), from security-sensitive applications.
151	   In a TEE ecosystem, device vendors may use different operating
152	   systems in the REE and may use different types of TEEs.  When Trusted
153	   Component Developers or Device Administrators use Trusted Application
154	   Managers (TAMs) to install, update, and delete Trusted Applications
155	   and their dependencies on a wide range of devices with potentially
156	   different TEEs, then an interoperability need arises.

158	   This document specifies the protocol for communicating between a TAM
159	   and a TEEP Agent.

161	   The Trusted Execution Environment Provisioning (TEEP) architecture
162	   document [RFC9397] provides design guidance and introduces the
163	   necessary terminology.

165	2.  Terminology

167	   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
168	   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
169	   "OPTIONAL" in this document are to be interpreted as described in
170	   BCP 14 [RFC2119] [RFC8174] when, and only when, they appear in all
171	   capitals, as shown here.

173	   This specification reuses the terminology defined in [RFC9397].

175	   As explained in Section 4.4 of that document, the TEEP protocol
176	   treats each Trusted Application (TA), any dependencies the TA has,
177	   and personalization data as separate components that are expressed in
178	   SUIT manifests, and a SUIT manifest might contain or reference
179	   multiple binaries (see [I-D.ietf-suit-manifest] for more details).

181	   As such, the term Trusted Component (TC) in this document refers to a
182	   set of binaries expressed in a SUIT manifest, to be installed in a
183	   TEE.  Note that a Trusted Component may include one or more TAs and/
184	   or configuration data and keys needed by a TA to operate correctly.

186	   Each Trusted Component is uniquely identified by a SUIT Component
187	   Identifier (see [I-D.ietf-suit-manifest] Section 8.7.2.2).

189	   Attestation related terms, such as Evidence and Attestation Results,
190	   are as defined in [RFC9334].

192	3.  Message Overview

194	   The TEEP protocol consists of messages exchanged between a TAM and a
195	   TEEP Agent.  The TEEP protocol is transport-agnostic; bindings to
196	   specific transports are defined in separate companion specifications.
197	   Deployments MAY use a single TAM or multiple TAMs; local policy
198	   determines which TAMs are permitted to manage a given device.  Since
199	   single TAM deployments are more likely, we assume them as a default.
200	   The messages are encoded in CBOR and designed to provide end-to-end
201	   security.  TEEP protocol messages are signed by the endpoints, i.e.,
202	   the TAM and the TEEP Agent, but Trusted Applications may also be
203	   encrypted and signed by a Trusted Component Developer or Device
204	   Administrator.  The TEEP protocol not only uses CBOR but also the
205	   respective security wrapper, namely COSE [RFC9052].  Furthermore, for
206	   software updates the SUIT manifest format [I-D.ietf-suit-manifest] is
207	   used, and for attestation the Entity Attestation Token (EAT)
208	   [RFC9711] format is supported although other attestation formats are
209	   also permitted.

211	   This specification defines five messages: QueryRequest,
212	   QueryResponse, Update, Success, and Error.

214	   A TAM queries a device's current state with a QueryRequest message.
215	   A TEEP Agent will, after authenticating and authorizing the request,
216	   report attestation information, list all Trusted Components, and
217	   provide information about supported algorithms and extensions in a
218	   QueryResponse message.  An error message is returned if the request
219	   could not be processed.  A TAM will process the QueryResponse message
220	   and determine whether to initiate subsequent message exchanges to
221	   install, update, or delete Trusted Applications.  As discussed in
222	   Section 7.2, a QueryResponse can also be sent unsolicited when the
223	   contents of the corresponding QueryRequest are already known and do
224	   not vary per message.

226	     +------------+           +-------------+
227	     | TAM        |           |TEEP Agent   |
228	     +------------+           +-------------+

230	       QueryRequest ------->

232	                              QueryResponse

234	                    <-------     or

236	                                Error

238	   With the Update message a TAM can instruct a TEEP Agent to install
239	   and/or delete one or more Trusted Components.  The TEEP Agent will
240	   process the message, determine whether the TAM is authorized and
241	   whether the Trusted Component has been signed by an authorized
242	   Trusted Component Signer.  A Success message is returned when the
243	   operation has been completed successfully, or an Error message
244	   otherwise.

246	    +------------+           +-------------+
247	    | TAM        |           |TEEP Agent   |
248	    +------------+           +-------------+

250	                Update  ---->

252	                               Success

254	                       <----    or

256	                               Error

258	4.  Detailed Messages Specification

260	   TEEP messages are protected by the COSE_Sign1 or COSE_Sign structure
261	   as described in Section 8.1.  The TEEP protocol messages are
262	   described in CDDL format [RFC8610] below.  The complete CDDL
263	   definitions for all messages appear in Appendix C; the snippets in
264	   this section focus on the fields discussed.

266	   teep-message = $teep-message-type .within teep-message-framework

268	   teep-message-framework = [
269	     type: $teep-type / $teep-type-extension,
270	     options: { * teep-option },
271	     * any; further elements, e.g., for data-item-requested
272	   ]

274	   teep-option = (uint => any)

276	   ; messages defined below:
277	   $teep-message-type /= query-request
278	   $teep-message-type /= query-response
279	   $teep-message-type /= update
280	   $teep-message-type /= success
281	   $teep-message-type /= error

283	   ; message type numbers, in one byte which could take a
284	   ; number from 0 to 23
285	   $teep-type /= (0..23)
286	   TEEP-TYPE-query-request = 1
287	   TEEP-TYPE-query-response = 2
288	   TEEP-TYPE-update = 3
289	   TEEP-TYPE-success = 5
290	   TEEP-TYPE-error = 6
291	   ; value 4 is reserved for future use; registries are
292	   ; intentionally sparse and values are not required to be contiguous.

294	4.1.  Creating and Validating TEEP Messages

296	4.1.1.  Creating a TEEP message

298	   To create a TEEP message, the following steps are performed.

300	   1.  Create a TEEP message according to the description below and
301	       populate it with the respective content.  TEEP messages sent by
302	       TAMs (QueryRequest and Update) can include a "token".  The TAM
303	       can decide, in any implementation-specific way, whether to
304	       include a token in a message.  The initial token value generated
305	       by a TAM MUST be produced using a cryptographically secure random
306	       source.  Subsequent token values MUST be different for each
307	       message the TAM creates.

309	   2.  Create a COSE header containing the desired set of header
310	       parameters.  The COSE header MUST be valid per the [RFC9052]
311	       specification.

313	   3.  Create a COSE_Sign1 or COSE_Sign object using the TEEP message as
314	       the COSE_Sign1 or COSE_Sign Payload; all steps specified in
315	       [RFC9052] for creating a COSE_Sign1 or COSE_Sign object MUST be
316	       followed.

318	4.1.2.  Validating a TEEP Message

320	   When a TEEP message is received (see the ProcessTeepMessage
321	   conceptual API defined in Section 6.2.1 of [RFC9397]), the following
322	   validation steps are performed.  If any of the listed steps fail,
323	   then the TEEP message MUST be rejected.

325	   1.  Verify that the received message is a valid CBOR object.

327	   2.  Verify that the message contains a COSE_Sign1 or COSE_Sign
328	       structure.

330	   3.  Verify that the resulting COSE header includes only parameters
331	       and values whose syntax and semantics are both understood and
332	       supported or that are specified as being ignored when not
333	       understood.

335	   4.  Follow the steps specified in Section 4 of [RFC9052] ("Signing
336	       Objects") for validating a COSE_Sign1 or COSE_Sign object.  The
337	       COSE_Sign1 or COSE_Sign payload is the content of the TEEP
338	       message.

340	   5.  Verify that the TEEP message is a valid CBOR map and verify the
341	       fields of the TEEP message according to this specification.

343	4.2.  QueryRequest Message

345	   A QueryRequest message is used by the TAM to learn information from
346	   the TEEP Agent, such as the features supported by the TEEP Agent,
347	   including cipher suites and protocol versions.  Additionally, the TAM
348	   can selectively request data items from the TEEP Agent by using the
349	   data-item-requested parameter.  Currently, the following features are
350	   supported:

352	   *  Request for attestation information of the TEEP Agent,

354	   *  Listing supported extensions,

356	   *  Querying installed Trusted Components, and

358	   *  Request for logging information in SUIT Reports.

360	   Like other TEEP messages, the QueryRequest message is signed, and the
361	   relevant CDDL snippet is shown below.

363	   query-request = [
364	     type: TEEP-TYPE-query-request,
365	     options: {
366	       ? token => bstr .size (8..64),
367	       ? supported-freshness-mechanisms => [ + $freshness-mechanism ],
368	       ? challenge => bstr .size (8..512),
369	       ? versions => [ + version ],
370	       ? attestation-payload-format => text,
371	       ? attestation-payload => bstr,
372	       ? suit-reports => [ + bstr .cbor
373	                (SUIT_Report_Protected / SUIT_Report_Unprotected) ],
374	       * $$query-request-extensions,
375	       * $$teep-option-extensions
376	     },
377	     supported-teep-cipher-suites: [ + $teep-cipher-suite ],
378	     supported-suit-cose-profiles: [ + $suit-cose-profile ],
379	     data-item-requested: uint .bits data-item-requested
380	   ]

382	   version = uint .size 4
383	   ext-info = uint .size 4

385	   ; data items as bitmaps
386	   data-item-requested = &(
387	     attestation: 0,
388	     trusted-components: 1,
389	     extensions: 2,
390	     suit-reports: 3,
391	   )

393	   The message has the following fields:

395	   type
396	      The value of (1) corresponds to a QueryRequest message sent from
397	      the TAM to the TEEP Agent.

399	   token
400	      The value in the token parameter is used to match responses to
401	      requests, such as to look up any implementation-specific state it
402	      might have saved about that request, or to ignore responses to
403	      older QueryRequest messages before some configuration changes were
404	      made that affected their content.  This is particularly useful
405	      when a TAM issues multiple concurrent requests to a TEEP Agent.
406	      The token MUST be present if and only if the attestation bit is
407	      clear in the data-item-requested value (i.e., the attestation bit,
408	      which is bit 0 in the bitmap, is not set).  When the attestation
409	      bit is clear then a challenge will be included, which offers
410	      replay protection capabilities.  The size of the token is at least
411	      8 bytes (64 bits) and maximum of 64 bytes.  The first usage of a
412	      token generated by a TAM MUST be randomly created.  Subsequent
413	      token values MUST be different for each request message to
414	      distinguish the correct response from multiple requests.  The
415	      token value MUST NOT be used for other purposes, such as a TAM to
416	      identify the devices and/or a device to identify TAMs or Trusted
417	      Components.  The TAM SHOULD set an expiration time for each token
418	      to facilitate cleanup of stale request state, and MUST ignore any
419	      messages with expired tokens.  Implementations without explicit
420	      token management (e.g., simple TAMs that process requests
421	      synchronously and do not maintain state) may not need explicit
422	      token expiration.  The TAM MUST expire the token value after
423	      receiving the first response containing the token value and ignore
424	      any subsequent messages that have the same token value.
425	      Implementations SHOULD use a timeout mechanism (see Section 7.1)
426	      to eventually discard unanswered requests that have been awaiting
427	      responses for an excessive duration.

429	   supported-teep-cipher-suites
430	      The supported-teep-cipher-suites parameter lists the TEEP cipher
431	      suites supported by the TAM.  Details about the cipher suite
432	      encoding can be found in Section 8.1.

434	   supported-suit-cose-profiles
435	      The supported-suit-cose-profiles parameter lists the SUIT profiles
436	      supported by the TAM for parsing SUIT Reports.  Details about the
437	      cipher suite encoding can be found in Section 8.2.

439	   data-item-requested
440	      The data-item-requested parameter indicates what information the
441	      TAM requests from the TEEP Agent in the form of a bitmap.

443	      attestation (1):  With this value the TAM requests the TEEP Agent
444	         to return an attestation payload, whether Evidence (e.g., an
445	         EAT) or an Attestation Result, in the response.

447	      trusted-components (2):  With this value the TAM queries the TEEP
448	         Agent for all installed Trusted Components.

450	      extensions (4):  With this value the TAM queries the TEEP Agent
451	         for supported capabilities and extensions, which allows a TAM
452	         to discover the capabilities of a TEEP Agent implementation.

454	      suit-reports (8):  With this value the TAM requests the TEEP Agent
455	         to return SUIT Reports in the response.

457	      Further values may be added in the future.

459	   supported-freshness-mechanisms
460	      The supported-freshness-mechanisms parameter lists the freshness
461	      mechanism(s) supported by the TAM.  Details about the encoding can
462	      be found in Section 9.  If this parameter is absent, it means only
463	      the nonce mechanism is supported.  It MUST be absent if the
464	      attestation bit is clear.

466	   challenge
467	      The challenge field is an optional parameter used for ensuring the
468	      freshness of attestation Evidence returned with a QueryResponse
469	      message.  It MUST be absent if the attestation bit is clear or the
470	      Passport model (see [RFC9334]) is used.  When a challenge is
471	      provided in the QueryRequest and Evidence in the form of an EAT is
472	      returned with a QueryResponse message then the challenge contained
473	      in the QueryRequest MUST be used to generate the EAT, by copying
474	      the challenge into the eat_nonce claim (Section 4.1 of [RFC9711])
475	      if the nonce-based freshness mechanism is used for attestation
476	      Evidence.  For more details about freshness of Evidence see
477	      Section 9.

479	      If any format other than EAT is used, it is up to that format to
480	      define the use of the challenge field.

482	   versions
483	      The versions parameter enumerates the TEEP protocol version(s)
484	      supported by the TAM.  A value of 0 refers to the version of the
485	      TEEP protocol defined in this document.  If this field is not
486	      present, it is to be treated the same as if it contained only
487	      version 0.

489	   attestation-payload-format
490	      The attestation-payload-format parameter indicates the IANA Media
491	      Type of the attestation-payload parameter, where media type
492	      parameters are permitted after the media type.  For protocol
493	      version 0, the absence of this parameter indicates that the format
494	      is "application/eat+cwt; eat_profile=urn:ietf:rfc:rfcXXXX" (see
495	      [RFC9782] for further discussion).  (RFC-editor: upon RFC
496	      publication, replace XXXX above with the RFC number of this
497	      document.)  It MUST be present if the attestation-payload
498	      parameter is present and the format is not an EAT in CWT format
499	      with the profile defined below in Section 5.

501	   attestation-payload
502	      The attestation-payload parameter contains Evidence or an
503	      Attestation Result for the TEEP Agent to use to perform
504	      attestation of the TAM.  If the attestation-payload-format
505	      parameter is absent, the attestation payload contained in this
506	      parameter MUST be an Entity Attestation Token following the
507	      encoding defined in [RFC9711].  See Section 4.3.1 for further
508	      discussion.

510	   suit-reports
511	      If present, the suit-reports parameter contains a set of TAM SUIT
512	      Reports related to “boot” time (including the start of an
513	      executable in an OS context), as defined by SUIT_Report in
514	      Section 4 of [I-D.ietf-suit-report].  SUIT Reports are encoded as
515	      CBOR byte strings containing either SUIT_Report_Protected or
516	      SUIT_Report_Unprotected.  When a SUIT Report includes its own COSE
517	      protection (via signatures or MACs), the cryptographic key used
518	      MUST be distinct from the key used for the TEEP message's COSE
519	      security wrapper since otherwise its authenticity relies on the
520	      TEEP message's signature/MAC keys without adding any additional
521	      security.  SUIT Reports can be useful in QueryRequest messages to
522	      pass additional information about the TAM to the TEEP Agent
523	      without depending on a Verifier including the relevant information
524	      in the TAM's Attestation Results.

526	4.3.  QueryResponse Message

528	   The QueryResponse message is the successful response by the TEEP
529	   Agent after receiving a QueryRequest message.  As discussed in
530	   Section 7.2, it can also be sent unsolicited if the contents of the
531	   QueryRequest are already known and do not vary per message.

533	   Like other TEEP messages, the QueryResponse message is signed, and
534	   the relevant CDDL snippet is shown below.

536	   query-response = [
537	     type: TEEP-TYPE-query-response,
538	     options: {
539	       ? token => bstr .size (8..64),
540	       ? selected-version => version,
541	       ? attestation-payload-format => text,
542	       ? attestation-payload => bstr,
543	       ? suit-reports => [ + bstr .cbor
544	                (SUIT_Report_Protected / SUIT_Report_Unprotected) ],
545	       ? tc-list => [ + system-property-claims ],
546	       ? requested-tc-list => [ + requested-tc-info ],
547	       ? unneeded-manifest-list => [ + SUIT_Component_Identifier ],
548	       ? ext-list => [ + ext-info ],
549	       * $$query-response-extensions,
550	       * $$teep-option-extensions
551	     }
552	   ]

554	   requested-tc-info = {
555	     component-id => SUIT_Component_Identifier,
556	     ? tc-manifest-sequence-number => uint,
557	     ? have-binary => bool
558	   }

560	   The QueryResponse message has the following fields:

562	   type
563	      The value of (2) corresponds to a QueryResponse message sent from
564	      the TEEP Agent to the TAM.

566	   token
567	      The value in the token parameter is used to match responses to
568	      requests.  The value MUST correspond to the value received with
569	      the QueryRequest message if one was present, and MUST be absent if
570	      no token was present in the QueryRequest.

572	   selected-version
573	      The selected-version parameter indicates the TEEP protocol version
574	      selected by the TEEP Agent.  The absence of this parameter
575	      indicates the same as if it was present with a value of 0.
576	      Version values are defined by Standards Track RFCs; this document
577	      does not create a separate IANA registry for versions.

579	   attestation-payload-format
580	      The attestation-payload-format parameter indicates the IANA Media
581	      Type of the attestation-payload parameter, where media type
582	      parameters are permitted after the media type.  For protocol
583	      version 0, the absence of this parameter indicates that the format
584	      is "application/eat+cwt; eat_profile=urn:ietf:rfc:rfcXXXX" (see
585	      [RFC9782] for further discussion).  (RFC-editor: upon RFC
586	      publication, replace XXXX above with the RFC number of this
587	      document.)  It MUST be present if the attestation-payload
588	      parameter is present and the format is not an EAT in CWT format
589	      with the profile defined below in Section 5.

591	   attestation-payload
592	      The attestation-payload parameter contains Evidence or an
593	      Attestation Result.  This parameter MUST be present if the
594	      QueryResponse is sent in response to a QueryRequest with the
595	      attestation bit set.  If the attestation-payload-format parameter
596	      is absent, the attestation payload contained in this parameter
597	      MUST be an Entity Attestation Token following the encoding defined
598	      in [RFC9711].  See Section 4.3.1 for further discussion.

600	   suit-reports
601	      If present, the suit-reports parameter contains a set of "boot"
602	      (including starting an executable in an OS context) time SUIT
603	      Reports as defined by SUIT_Report in Section 4 of
604	      [I-D.ietf-suit-report], encoded as CBOR byte strings containing
605	      either SUIT_Report_Protected or SUIT_Report_Unprotected.  When
606	      protected, SUIT reports use COSE as discussed in Section 8.2.  If
607	      a token parameter was present in the QueryRequest message the
608	      QueryResponse message is in response to, the suit-report-nonce
609	      field MUST be present in the SUIT Report with a value matching the
610	      token parameter in the QueryRequest message.  SUIT Reports can be
611	      useful in QueryResponse messages to pass information to the TAM
612	      without depending on a Verifier including the relevant information
613	      in Attestation Results.

615	   tc-list
616	      The tc-list parameter enumerates the Trusted Components installed
617	      on the device in the form of system-property-claims objects, as
618	      defined in Section 4 of [I-D.ietf-suit-report].  The system-
619	      property-claims can be used to learn device identifying
620	      information and TEE identifying information for distinguishing
621	      which Trusted Components to install in the TEE.  This parameter
622	      MUST be present if the QueryResponse is sent in response to a
623	      QueryRequest with the trusted-components bit set.

625	   requested-tc-list
626	      The requested-tc-list parameter enumerates the Trusted Components
627	      that are not currently installed in the TEE, but which are
628	      requested to be installed, for example by an installer of an
629	      Untrusted Application that has a TA as a dependency, or by a
630	      Trusted Application that has another Trusted Component as a
631	      dependency.  Requested Trusted Components are expressed in the
632	      form of requested-tc-info objects.  A TEEP Agent can get this
633	      information from the RequestTA conceptual API defined in [RFC9397]
634	      Section 6.2.1.

636	   unneeded-manifest-list
637	      The unneeded-manifest-list parameter enumerates the SUIT manifests
638	      whose components are currently installed in the TEE, but which are
639	      no longer needed by any other application.  The TAM can use this
640	      information in determining whether a SUIT manifest can be
641	      unlinked.  Each unneeded SUIT manifest is identified by its SUIT
642	      Manifest Component ID (note that this is the Component ID for the
643	      manifest itself, which is different from the Component ID of a
644	      component installed by the manifest, see
645	      [I-D.ietf-suit-trust-domains] for more discussion).  A TEEP Agent
646	      can get this information from the UnrequestTA conceptual API
647	      defined in [RFC9397] Section 6.2.1.

649	   ext-list
650	      The ext-list parameter lists the supported extensions.  This
651	      document does not define any extensions.  This parameter MUST be
652	      present if the QueryResponse is sent in response to a QueryRequest
653	      with the extensions bit set.

655	   The requested-tc-info message has the following fields:

657	   component-id
658	      A SUIT Component Identifier; see [RFC9124].

660	   tc-manifest-sequence-number
661	      The minimum suit-manifest-sequence-number value from a SUIT
662	      manifest for the Trusted Component.  If not present, indicates
663	      that any sequence number will do.

665	   have-binary
666	      If present with a value of true, indicates that the TEEP Agent
667	      already has the Trusted Component binary and only needs an Update
668	      message with a SUIT manifest that authorizes installing it.  If
669	      have-binary is true, the tc-manifest-sequence-number field MUST be
670	      present.

672	4.3.1.  Evidence and Attestation Results

674	   Section 7 of [RFC9397] lists information that may appear in Evidence
675	   depending on the circumstance.  However, the Evidence is opaque to
676	   the TEEP protocol and there are no formal requirements on the
677	   contents of Evidence.

679	   TAMs consume Attestation Results and do need enough information
680	   therein to make decisions on how to remediate a TEE that is out of
681	   compliance, or update a TEE that is requesting an authorized change.
682	   To do so, the information in Section 7 of [RFC9397] is often required
683	   depending on the policy.

685	   Attestation Results SHOULD use Entity Attestation Tokens (EATs) to
686	   use a standardized format and to reduce TAM implementation
687	   complexity.  Use of any other format, such as a widely implemented
688	   format for a specific processor vendor, is permitted when
689	   standardized EAT support is not available or when proprietary formats
690	   provide essential functionality, but this increases the complexity of
691	   the TAM by requiring it to understand the format for each such format
692	   rather than only the common EAT format and is not recommended for
693	   interoperable deployments.  Deployments that choose a non-EAT format
694	   SHOULD document the format and pre-configure both the TAM and TEEP
695	   Agent accordingly; otherwise interoperability across vendors is
696	   likely to be reduced.

698	   When an EAT is used, the following claims can be used to meet those
699	   requirements, whether these claims appear in Attestation Results, or
700	   in Evidence for the Verifier to use when generating Attestation
701	   Results of some form:

703	   +==========================+===========+============================+
704	   | Requirement              | Claim     | Reference                  |
705	   +==========================+===========+============================+
706	   | Freshness proof          | nonce     | Section 4.1 of [RFC9711]   |
707	   +--------------------------+-----------+----------------------------+
708	   | Device unique identifier | ueid      | Section 4.2.1 of           |
709	   |                          |           | [RFC9711]                  |
710	   +--------------------------+-----------+----------------------------+
711	   | Vendor of the device     | oemid     | Section 4.2.3 of           |
712	   |                          |           | [RFC9711]                  |
713	   +--------------------------+-----------+----------------------------+
714	   | Class of the device      | hwmodel   | Section 4.2.4 of           |
715	   |                          |           | [RFC9711]                  |
716	   +--------------------------+-----------+----------------------------+
717	   | TEE hardware type        | hwversion | Section 4.2.5 of           |
718	   |                          |           | [RFC9711]                  |
719	   +--------------------------+-----------+----------------------------+
720	   | TEE hardware version     | hwversion | Section 4.2.5 of           |
721	   |                          |           | [RFC9711]                  |
722	   +--------------------------+-----------+----------------------------+
723	   | TEE firmware type        | manifests | Section 4.2.15 of          |
724	   |                          |           | [RFC9711]                  |
725	   +--------------------------+-----------+----------------------------+
726	   | TEE firmware version     | manifests | Section 4.2.15 of          |
727	   |                          |           | [RFC9711]                  |
728	   +--------------------------+-----------+----------------------------+

730	                                  Table 1

732	   The "manifests" claim (see Section 4.2.15 of [RFC9711]) should
733	   include information about the TEEP Agent as well as any of its
734	   dependencies such as firmware.

736	4.4.  Update Message

738	   The Update message is used by a TAM to install and/or delete one or
739	   more Trusted Components via the TEEP Agent.  It can also be used to
740	   pass a successful Attestation Report back to the TEEP Agent when the
741	   TAM is configured as an intermediary between the TEEP Agent and a
742	   Verifier, as shown in Figure 1, where the Attestation Result passed
743	   back to the Attester can be used as a so-called "passport" (see
744	   Section 5.1 of [RFC9334]) that can be presented to other Relying
745	   Parties.

747	            +---------------+
748	            |   Verifier    |
749	            +---------------+
750	                  ^    | Attestation
751	         Evidence |    v   Result
752	            +---------------+
753	            |     TAM /     |
754	            | Relying Party |
755	            +---------------+
756	    QueryResponse ^    |    Update
757	      (Evidence)  |    | (Attestation
758	                  |    v    Result)
759	            +---------------+             +---------------+
760	            |  TEEP Agent   |------------>|     Other     |
761	            |  / Attester   | Attestation | Relying Party |
762	            +---------------+    Result   +---------------+

764	               Figure 1: Example use of TEEP and Attestation.

766	   Like other TEEP messages, the Update message is signed, and the
767	   relevant CDDL snippet is shown below.

769	   update = [
770	     type: TEEP-TYPE-update,
771	     options: {
772	       ? token => bstr .size (8..64),
773	       ? unneeded-manifest-list => [ + SUIT_Component_Identifier ],
774	       ? manifest-list => [ + bstr .cbor SUIT_Envelope ],
775	       ? attestation-payload-format => text,
776	       ? attestation-payload => bstr,
777	       ? err-code => err-code-values,
778	       ? err-msg => text .size (1..128),
779	       ? err-lang => text .size (1..35),
780	       * $$update-extensions,
781	       * $$teep-option-extensions
782	     }
783	   ]

785	   The Update message has the following fields:

787	   type
788	      The value of (3) corresponds to an Update message sent from the
789	      TAM to the TEEP Agent.  In case of successful processing, a
790	      Success message is returned by the TEEP Agent.  In case of an
791	      error, an Error message is returned.  Note that the Update message
792	      is used for initial Trusted Component installation as well as for
793	      updates and deletes.

795	   token
796	      The value in the token field is used to match responses to
797	      requests.

799	   unneeded-manifest-list
800	      The unneeded-manifest-list parameter enumerates the SUIT manifests
801	      to be unlinked.  Each unneeded SUIT manifest is identified by its
802	      SUIT Manifest Component ID.  The SUIT manifest processor MAY
803	      execute uninstall section in the manifest.  See Section 7 of
804	      [I-D.ietf-suit-trust-domains] for more information about the suit-
805	      uninstall Command Sequence.

807	   manifest-list
808	      The manifest-list field is used to convey one or multiple SUIT
809	      manifests to install.  A manifest is a bundle of metadata about a
810	      Trusted Component, such as where to find the code, the devices to
811	      which it applies, and cryptographic information protecting the
812	      manifest.  The manifest may also convey personalization data.
813	      Trusted Component binaries and personalization data can be signed
814	      and encrypted by the same Trusted Component Signer.  Other
815	      combinations are, however, possible as well.  For example, it is
816	      also possible for the TAM to sign and encrypt the personalization
817	      data and to let the Trusted Component Developer sign and/or
818	      encrypt the Trusted Component binary.

820	   attestation-payload-format
821	      The attestation-payload-format parameter indicates the IANA Media
822	      Type of the attestation-payload parameter, where media type
823	      parameters are permitted after the media type.  The absence of
824	      this parameter indicates that the format is "application/eat+cwt;
825	      eat_profile=urn:ietf:rfc:rfcXXXX" (see [RFC9782] for further
826	      discussion).  (RFC-editor: upon RFC publication, replace XXXX
827	      above with the RFC number of this document.)  It MUST be present
828	      if the attestation-payload parameter is present and the format is
829	      not an EAT in CWT format with the profile defined in Section 5.

831	   attestation-payload
832	      The attestation-payload parameter contains an Attestation Result.
833	      If the attestation-payload-format parameter is absent, the
834	      attestation payload contained in this parameter MUST be an Entity
835	      Attestation Token following the encoding defined in [RFC9711].
836	      See Section 4.3.1 for further discussion.

838	   err-code
839	      The err-code parameter contains one of the error codes listed in
840	      the Section 4.6, which describes the reasons for the error when
841	      performing QueryResponse in the TAM.  The value 0 is reserved and
842	      MUST NOT be used.

844	   err-msg
845	      The err-msg parameter is human-readable diagnostic text that MUST
846	      be encoded using UTF-8 [RFC3629] in Net-Unicode format [RFC5198]
847	      with a maximum of 128 bytes.

849	   err-lang
850	      The err-lang parameter is an optional RFC 5646 [RFC5646] language
851	      tag identifying the language of the err-msg text.  When present,
852	      implementations MUST use the language tag to aid human operators
853	      in interpreting diagnostic text.  The err-msg field SHOULD be
854	      formatted in the language indicated by this tag.  If the indicated
855	      language is not supported, implementations MAY ignore the tag and
856	      treat err-msg as opaque text, but MUST still process err-code.

858	   Note that an Update message carrying one or more SUIT manifests will
859	   inherently involve multiple signatures, one by the TAM in the TEEP
860	   message and one from a Trusted Component Signer inside each manifest.
861	   This is intentional as they are for different purposes.

863	   The TAM is what authorizes apps to be installed, updated, and deleted
864	   on a given TEE and so the TEEP signature is checked by the TEEP Agent
865	   at protocol message processing time.  (This same TEEP security
866	   wrapper is also used on messages like QueryRequest so that Agents
867	   only send potentially sensitive data such as Evidence to trusted
868	   TAMs.)

870	   The Trusted Component signer, on the other hand, is what authorizes
871	   the Trusted Component to actually run, so the manifest signature
872	   could be checked at install time, load (or run) time, or both, and
873	   this checking is done by the TEE independent of whether TEEP is used
874	   or some other update mechanism.  See Section 5 of [RFC9397] for
875	   further discussion.

877	   The Update message has a SUIT_Envelope containing SUIT manifests.
878	   Following are some example scenarios using SUIT manifests in the
879	   Update Message.

881	4.4.1.  Scenario 1: Having one SUIT Manifest pointing to a URI of a
882	        Trusted Component Binary

884	   In this scenario, a SUIT Manifest has a URI pointing to a Trusted
885	   Component Binary.

887	   A Trusted Component Developer creates a new Trusted Component Binary
888	   and hosts it at a Trusted Component Developer's URI.  Then, the
889	   Trusted Component Developer generates an associated SUIT manifest
890	   with the filename "tc-uuid" that contains the URI.  The filename "tc-
891	   uuid" is used in Scenario 3 later.

893	   The TAM receives the latest SUIT manifest from the Trusted Component
894	   Developer, and the URI it contains cannot be changed by the TAM since
895	   the SUIT manifest is signed by the Trusted Component Developer.

897	   Figure 2 shows the exchange graphically.

899	   Pros:

901	   *  The Trusted Component Developer can ensure that the intact Trusted
902	      Component Binary is downloaded by devices

904	   *  The TAM does not have to send large Update messages containing the
905	      Trusted Component Binary

907	   Cons:

909	   *  The Trusted Component Developer must host the Trusted Component
910	      Binary server

912	   *  The device must fetch the Trusted Component Binary in another
913	      connection after receiving an Update message

915	   *  A device's IP address and therefore location may be revealed to
916	      the Trusted Component Binary server
917	       +------------+           +-------------+
918	       | TAM        |           | TEEP Agent  |
919	       +------------+           +-------------+

921	                Update  ---->

923	       +=================== teep-protocol(TAM) ==================+
924	       | TEEP_Message([                                          |
925	       |   TEEP-TYPE-update,                                     |
926	       |   options: {                                            |
927	       |     manifest-list: [                                    |
928	       |       += suit-manifest "tc-uuid" (TC Developer) ======+ |
929	       |       | SUIT_Envelope({                               | |
930	       |       |   manifest: {                                 | |
931	       |       |     install: {                                | |
932	       |       |       override-parameters: {                  | |
933	       |       |         uri: "https://example.org/tc-uuid.ta" | |
934	       |       |       },                                      | |
935	       |       |       fetch                                   | |
936	       |       |     }                                         | |
937	       |       |   }                                           | |
938	       |       | })                                            | |
939	       |       +===============================================+ |
940	       |     ]                                                   |
941	       |   }                                                     |
942	       | ])                                                      |
943	       +=========================================================+

945	       and then,

947	       +-------------+          +--------------+
948	       | TEEP Agent  |          | TC Developer |
949	       +-------------+          +--------------+

951	                        <----

953	         fetch "https://example.org/tc-uuid.ta"

955	             +======= tc-uuid.ta =======+
956	             | 48 65 6C 6C 6F 2C 20 ... |
957	             +==========================+

959	               Figure 2: URI of the Trusted Component Binary.

961	   For the full SUIT Manifest example binary, see Appendix "Example 1:
962	   SUIT Manifest pointing to URI of the Trusted Component Binary".

964	4.4.2.  Scenario 2: Having a SUIT Manifest include the Trusted Component
965	        Binary

967	   In this scenario, the SUIT manifest contains the entire Trusted
968	   Component Binary as an integrated payload (see
969	   [I-D.ietf-suit-manifest] Section 7.5).

971	   A Trusted Component Developer delegates the task of delivering the
972	   Trusted Component Binary to the TAM inside the SUIT manifest.  The
973	   Trusted Component Developer creates a SUIT manifest and embeds the
974	   Trusted Component Binary, which is referenced in the suit-integrated-
975	   payload element containing the fragment-only reference "#tc", in the
976	   envelope.  The Trusted Component Developer transmits the entire
977	   bundle to the TAM.

979	   The TAM serves the SUIT manifest containing the Trusted Component
980	   Binary to the device in an Update message.

982	   Figure 3 shows the exchange graphically.

984	   Pros:

986	   *  The device can obtain the Trusted Component Binary and the SUIT
987	      manifest in one Update message.

989	   *  The Trusted Component Developer does not have to host a server to
990	      deliver the Trusted Component Binary to devices.

992	   Cons:

994	   *  The TAM must host the Trusted Component Binary rather than
995	      delegating storage to the Trusted Component Developer.

997	   *  The TAM must deliver Trusted Component Binaries in Update
998	      messages, which increases the size of the Update message.

1000	       +------------+           +-------------+
1001	       | TAM        |           | TEEP Agent  |
1002	       +------------+           +-------------+

1004	                Update  ---->

1006	         +=========== teep-protocol(TAM) ============+
1007	         | TEEP_Message([                            |
1008	         |   TEEP-TYPE-update,                       |
1009	         |   options: {                              |
1010	         |     manifest-list: [                      |
1011	         |       +== suit-manifest(TC Developer) ==+ |
1012	         |       | SUIT_Envelope({                 | |
1013	         |       |   manifest: {                   | |
1014	         |       |     install: {                  | |
1015	         |       |       override-parameters: {    | |
1016	         |       |         uri: "#tc"              | |
1017	         |       |       },                        | |
1018	         |       |       fetch                     | |
1019	         |       |     }                           | |
1020	         |       |   },                            | |
1021	         |       |   "#tc": h'48 65 6C 6C ...'     | |
1022	         |       | })                              | |
1023	         |       +=================================+ |
1024	         |     ]                                     |
1025	         |   }                                       |
1026	         | ])                                        |
1027	         +===========================================+

1029	        Figure 3: Integrated Payload with Trusted Component Binary.

1031	   For the full SUIT Manifest example binary, see Appendix "Example 2:
1032	   SUIT Manifest including the Trusted Component Binary".

1034	4.4.3.  Scenario 3: Supplying Personalization Data for the Trusted
1035	        Component Binary

1037	   In this scenario, Personalization Data is associated with the Trusted
1038	   Component Binary "tc-uuid" from Scenario 1.

1040	   The Trusted Component Developer places encrypted Personalization Data
1041	   in the SUIT manifest, and it will be delivered by the TAM.  The SUIT
1042	   manifest processor decrypts it, then stores it in a file named
1043	   "config.json", and then installs the dependency component.

1045	   The TAM delivers the SUIT manifest of the Personalization Data which
1046	   depends on the Trusted Component Binary from Scenario 1.

1048	   Figure 4 shows the exchange graphically.

1050	       +------------+           +-------------+
1051	       | TAM        |           | TEEP Agent  |
1052	       +------------+           +-------------+

1054	                Update  ---->

1056	         +================== teep-protocol(TAM) ======================+
1057	         | TEEP_Message([                                             |
1058	         |   TEEP-TYPE-update,                                        |
1059	         |   options: {                                               |
1060	         |     manifest-list: [                                       |
1061	         |       +========= suit-manifest(TC Developer) ============+ |
1062	         |       | SUIT_Envelope({                                  | |
1063	         |       |   manifest: {                                    | |
1064	         |       |     common: {                                    | |
1065	         |       |       dependencies: {                            | |
1066	         |       |         dependency-prefix 1: {                   | |
1067	         |       |           [tc-uuid, 'suit']                      | |
1068	         |       |         }                                        | |
1069	         |       |       }                                          | |
1070	         |       |       components: [                              | |
1071	         |       |         ['config.json']                          | |
1072	         |       |       ]                                          | |
1073	         |       |     },                                           | |
1074	         |       |     dependency-resolution: {                     | |
1075	         |       |       override-parameters: {                     | |
1076	         |       |         uri: "https://example.org/tc-uuid"       | |
1077	         |       |       },                                         | |
1078	         |       |       fetch                                      | |
1079	         |       |     },                                           | |
1080	         |       |     install: {                                   | |
1081	         |       |       set-component-index 0,                     | |
1082	         |       |       override-parameters: {                     | |
1083	         |       |         content: h'48FE0794...'                  | |
1084	         |       |         encryption-info: << ... >>               | |
1085	         |       |       },                                         | |
1086	         |       |       write,                                     | |
1087	         |       |       set-component-index 1,                     | |
1088	         |       |       process-dependency                         | |
1089	         |       |     }                                            | |
1090	         |       |   }                                              | |
1091	         |       | })                                               | |
1092	         |       +==================================================+ |
1093	         |     ]                                                      |
1094	         |   }                                                        |
1095	         | ])                                                         |
1096	         +============================================================+
1097	                 Figure 4: Encrypted Personalization Data.

1099	   For the full SUIT Manifest example binary, see Appendix "Example 3:
1100	   Supplying Personalization Data for Trusted Component Binary".

1102	4.5.  Success Message

1104	   The Success message is used by the TEEP Agent to return a success in
1105	   response to an Update message.

1107	   Like other TEEP messages, the Success message is signed, and the
1108	   relevant CDDL snippet is shown below.

1110	   success = [
1111	     type: TEEP-TYPE-success,
1112	     options: {
1113	       ? token => bstr .size (8..64),
1114	       ? msg => text .size (1..128),
1115	       ? suit-reports => [ + bstr .cbor
1116	                (SUIT_Report_Protected / SUIT_Report_Unprotected) ],
1117	       * $$success-extensions,
1118	       * $$teep-option-extensions
1119	     }
1120	   ]

1122	   The Success message has the following fields:

1124	   type
1125	      The value of (5) corresponds to a Success message sent from the
1126	      TEEP Agent to the TAM.

1128	   token
1129	      The value in the token parameter is used to match responses to
1130	      requests.  It MUST match the value of the token parameter in the
1131	      Update message the Success is in response to, if one was present.
1132	      If none was present, the token MUST be absent in the Success
1133	      message.

1135	   msg
1136	      The msg parameter contains optional diagnostics information
1137	      encoded in UTF-8 [RFC3629] using Net-Unicode form [RFC5198] with
1138	      max 128 bytes returned by the TEEP Agent.

1140	   suit-reports
1141	      If present, the suit-reports parameter contains a set of SUIT
1142	      Reports as defined in Section 4 of [I-D.ietf-suit-report], encoded
1143	      as CBOR byte strings containing either SUIT_Report_Protected or
1144	      SUIT_Report_Unprotected.  When a SUIT Report includes its own COSE
1145	      protection (signatures or MACs), the cryptographic key used MUST
1146	      be distinct from the key used for the TEEP message's COSE security
1147	      wrapper.  If a token parameter was present in the Update message
1148	      the Success message is in response to, the suit-report-nonce field
1149	      MUST be present in the SUIT Report with a value matching the token
1150	      parameter in the Update message.

1152	4.6.  Error Message

1154	   The Error message is used by the TEEP Agent to return an error in
1155	   response to a message from the TAM.

1157	   Like other TEEP messages, the Error message is signed, and the
1158	   relevant CDDL snippet is shown below.

1160	   error = [
1161	     type: TEEP-TYPE-error,
1162	     options: {
1163	        ? token => bstr .size (8..64),
1164	        ? err-msg => text .size (1..128),
1165	        ? err-lang => text .size (1..35),
1166	        ? supported-teep-cipher-suites => [ + $teep-cipher-suite ],
1167	        ? supported-freshness-mechanisms => [ + $freshness-mechanism ],
1168	        ? supported-suit-cose-profiles => [ + $suit-cose-profile ],
1169	        ? challenge => bstr .size (8..512),
1170	        ? versions => [ + version ],
1171	        ? suit-reports => [ + bstr .cbor
1172	                (SUIT_Report_Protected / SUIT_Report_Unprotected) ],
1173	        * $$error-extensions,
1174	        * $$teep-option-extensions
1175	     },
1176	     err-code: err-code-values
1177	   ]

1179	   ; The err-code parameter, uint (1..23)
1180	   ERR_PERMANENT_ERROR = 1
1181	   ERR_UNSUPPORTED_EXTENSION = 2
1182	   ERR_UNSUPPORTED_FRESHNESS_MECHANISMS = 3
1183	   ERR_UNSUPPORTED_MSG_VERSION = 4
1184	   ERR_UNSUPPORTED_CIPHER_SUITES = 5
1185	   ERR_BAD_CERTIFICATE = 6
1186	   ERR_ATTESTATION_REQUIRED = 7
1187	   ERR_UNSUPPORTED_SUIT_REPORT = 8
1188	   ERR_CERTIFICATE_EXPIRED = 9
1189	   ERR_TEMPORARY_ERROR = 10
1190	   ERR_MANIFEST_PROCESSING_FAILED = 17

1192	   err-code-values = ERR_PERMANENT_ERROR
1193	            / ERR_UNSUPPORTED_EXTENSION
1194	            / ERR_UNSUPPORTED_FRESHNESS_MECHANISMS
1195	            / ERR_UNSUPPORTED_MSG_VERSION
1196	            / ERR_UNSUPPORTED_CIPHER_SUITES
1197	            / ERR_BAD_CERTIFICATE
1198	            / ERR_ATTESTATION_REQUIRED
1199	            / ERR_UNSUPPORTED_SUIT_REPORT
1200	            / ERR_CERTIFICATE_EXPIRED
1201	            / ERR_TEMPORARY_ERROR
1202	            / ERR_MANIFEST_PROCESSING_FAILED

1204	   The Error message has the following fields:

1206	   type
1207	      The value of (6) corresponds to an Error message sent from the
1208	      TEEP Agent to the TAM.

1210	   token
1211	      The value in the token parameter is used to match responses to
1212	      requests.  It MUST match the value of the token parameter in the
1213	      message the Success is in response to, if one was present.  If
1214	      none was present, the token MUST be absent in the Error message.

1216	   err-msg
1217	      The err-msg parameter is human-readable diagnostic text that MUST
1218	      be encoded using UTF-8 [RFC3629] using Net-Unicode form [RFC5198]
1219	      with max 128 bytes.

1221	   err-lang
1222	      The err-lang parameter is an optional RFC 5646 [RFC5646] language
1223	      tag identifying the language of the err-msg text.  When present,
1224	      implementations SHOULD use the language tag to aid human operators
1225	      in interpreting diagnostic text.  The err-msg field SHOULD be
1226	      formatted in the language indicated by this tag.  If the indicated
1227	      language is not supported, implementations MAY ignore the tag and
1228	      treat err-msg as opaque text, but MUST still process err-code.

1230	   supported-teep-cipher-suites
1231	      The supported-teep-cipher-suites parameter lists the TEEP cipher
1232	      suite(s) supported by the TEEP Agent.  Details about the cipher
1233	      suite encoding can be found in Section 8.1.  This otherwise
1234	      optional parameter MUST be returned if err-code is
1235	      ERR_UNSUPPORTED_CIPHER_SUITES.

1237	   supported-freshness-mechanisms
1238	      The supported-freshness-mechanisms parameter lists the freshness
1239	      mechanism(s) supported by the TEEP Agent.  Details about the
1240	      encoding can be found in Section 9.  This otherwise optional
1241	      parameter MUST be returned if err-code is
1242	      ERR_UNSUPPORTED_FRESHNESS_MECHANISMS.

1244	   supported-suit-cose-profiles
1245	      The supported-suit-cose-profiles parameter lists the SUIT profiles
1246	      supported by the TEEP Agent.  Details about the cipher suite
1247	      encoding can be found in Section 8.2.  This otherwise optional
1248	      parameter MUST be returned if err-code is
1249	      ERR_UNSUPPORTED_SUIT_REPORT.

1251	   challenge
1252	      The challenge field is an optional parameter used for ensuring the
1253	      freshness of attestation Evidence included with a QueryRequest
1254	      message.  When a challenge is provided in the Error message and
1255	      Evidence in the form of an EAT is returned with a QueryRequest
1256	      message then the challenge contained in the Error message MUST be
1257	      used to generate the EAT, by copying the challenge value into the
1258	      eat_nonce claim, as described in the EAT profile Section 5, if the
1259	      nonce-based freshness mechanism is used.  For more details see
1260	      Section 9.

1262	      If any format other than EAT is used, it is up to that format to
1263	      define the use of the challenge field.

1265	   versions
1266	      The versions parameter enumerates the TEEP protocol version(s)
1267	      supported by the TEEP Agent.  This otherwise optional parameter
1268	      MUST be returned if err-code is ERR_UNSUPPORTED_MSG_VERSION.

1270	   suit-reports
1271	      If present, the suit-reports parameter contains a set of SUIT
1272	      Reports as defined in Section 4 of [I-D.ietf-suit-report], encoded
1273	      as CBOR byte strings containing either protected or unprotected
1274	      SUIT Report payloads.  When a SUIT Report includes its own COSE
1275	      protection (signatures or MACs), the cryptographic key used MUST
1276	      be distinct from the key used for the TEEP message's COSE security
1277	      wrapper.  If a token parameter was present in the Update message
1278	      the Error message is in response to, the suit-report-nonce field
1279	      MUST be present in the SUIT Report with a value matching the token
1280	      parameter in the Update message.

1282	   err-code
1283	      The err-code parameter contains one of the error codes listed
1284	      below.  The value 0 is reserved and MUST NOT be used.  Only
1285	      selected values are applicable to each message.  Note that error
1286	      codes are restricted to the range (0..23) to permit encoding as
1287	      single-byte CBOR unsigned integers.  Error code values 0, 11-16,
1288	      and 18-22 are currently unassigned and reserved for future use.
1289	      Error code 0 is intentionally reserved to prevent accidental use.
1290	      Extensions that define new error codes SHOULD constrain values to
1291	      this range; however, implementations that receive unrecognized
1292	      error code values greater than 23 SHOULD handle them gracefully,
1293	      treating them as unknown errors.

1295	   This specification defines the following initial error messages:

1297	   ERR_PERMANENT_ERROR (1)
1298	      The received TEEP message contained incorrect fields or fields
1299	      that are inconsistent with other fields.  For diagnosis purposes
1300	      it is RECOMMENDED to identify the failure reason in the error
1301	      message field.  A TEEP implementation receiving this error might
1302	      refuse to communicate further with the problematic TEEP message
1303	      sender, by silently dropping any TEEP messages received, for some
1304	      period of time until it has reason to believe it is worth trying
1305	      again, but it should take care not to give up on communication.
1306	      In contrast, ERR_TEMPORARY_ERROR is an indication that a more
1307	      aggressive retry is warranted.

1309	   ERR_UNSUPPORTED_EXTENSION (2)
1310	      The TEEP implementation does not support an extension included in
1311	      the TEEP message it received.  For diagnosis purposes it is
1312	      RECOMMENDED to identify the unsupported extension in the error
1313	      message field.  A TAM implementation receiving this error might
1314	      retry sending the last message it sent to the sender of this
1315	      error, without using any TEEP extensions.

1317	   ERR_UNSUPPORTED_FRESHNESS_MECHANISMS (3)
1318	      The TEEP Agent does not support any freshness algorithm mechanisms
1319	      in the request message.  A TAM receiving this error might retry
1320	      the request using a different set of supported freshness
1321	      mechanisms in the request message.

1323	   ERR_UNSUPPORTED_MSG_VERSION (4)
1324	      The TEEP implementation does not support the TEEP protocol version
1325	      indicated in the received message.  A TAM receiving this error
1326	      might retry the request using a different TEEP protocol version.

1328	   ERR_UNSUPPORTED_CIPHER_SUITES (5)
1329	      The TEEP Agent does not support any cipher suites indicated in the
1330	      request message.  A TAM receiving this error might retry the
1331	      request using a different set of supported cipher suites in the
1332	      request message.

1334	   ERR_BAD_CERTIFICATE (6)
1335	      Processing of a certificate failed.  For diagnosis purposes it is
1336	      RECOMMENDED to include information about the failing certificate
1337	      in the error message field.  For example, the certificate was of
1338	      an unsupported type, or the certificate was revoked by its signer.
1339	      A TEEP implementation receiving this error might attempt to use an
1340	      alternate certificate.

1342	   ERR_ATTESTATION_REQUIRED (7)
1343	      Indicates that the TEEP implementation sending this error requires
1344	      attestation of the TEEP implementation receiving this error.

1346	   ERR_UNSUPPORTED_SUIT_REPORT (8)
1347	      Indicates that the TEEP Agent does not support the suit-cose-
1348	      profile of the SUIT Reports which was sent by the TAM.  The TEEP
1349	      Agent must report the error code ERR_UNSUPPORTED_SUIT_REPORT
1350	      supplying the supported-suit-cose-profiles.

1352	   ERR_CERTIFICATE_EXPIRED (9)
1353	      A certificate has expired or is not currently valid.  A TEEP
1354	      implementation receiving this error might attempt to renew its
1355	      certificate before using it again.

1357	   ERR_TEMPORARY_ERROR (10)
1358	      A miscellaneous temporary error, such as a memory allocation
1359	      failure, occurred while processing the TEEP message.  A TEEP
1360	      implementation receiving this error might retry the last message
1361	      it sent to the sender of this error at some later point, which is
1362	      up to the implementation.

1364	   ERR_MANIFEST_PROCESSING_FAILED (17)
1365	      The TEEP Agent encountered one or more manifest processing
1366	      failures.  If the suit-reports parameter is present, it contains
1367	      the failure details.  A TAM receiving this error might still
1368	      attempt to install or update other components that do not depend
1369	      on the failed manifest.

1371	   New error codes should be added sparingly, not for every
1372	   implementation error.  That is the intent of the err-msg field, which
1373	   can be used to provide details meaningful to humans.  New error codes
1374	   should only be added if the TAM is expected to do something
1375	   behaviorally different upon receipt of the error message, rather than
1376	   just logging the event.  Hence, each error code is responsible for
1377	   saying what the behavioral difference is expected to be.

1379	5.  EAT Profile

1381	   The TEEP protocol operates between a TEEP Agent and a TAM.  While the
1382	   TEEP protocol does not require use of EAT, use of EAT is encouraged
1383	   and Section 4.3 explicitly defines a way to carry an Entity
1384	   Attestation Token in a QueryResponse.

1386	   As noted in Section 4.3.1, Evidence is opaque to the TAM, while
1387	   Attestation Results are processed by the TAM in its role as the
1388	   Relying Party.  Although Attestation Results required by a TAM are
1389	   logically separate from the TEEP protocol, this section defines
1390	   requirements for building a compliant TAM that uses EATs for
1391	   Attestation Results.

1393	   Section 6 of [RFC9711] defines the requirement for Entity Attestation
1394	   Token profiles.  This section defines an EAT profile for use with
1395	   TEEP.

1397	   *  profile-label: The profile-label for this specification is the URI
1398	   <urn:ietf:rfc:rfcXXXX>.  (RFC-editor: upon RFC publication, replace
1399	   XXXX with the RFC number of this document.)

1401	   *  Use of JSON, CBOR, or both: CBOR only.

1403	   *  CBOR Map and Array Encoding: Only definite length arrays and maps.

1405	   *  CBOR String Encoding: Only definite-length strings are allowed.

1407	   *  CBOR Preferred Serialization: Encoders must use preferred
1408	      serialization, and decoders need not accept non-preferred
1409	      serialization.

1411	   *  CBOR Tags: CBOR Tags are not used.

1413	   *  COSE/JOSE Protection: See Section 8.2.

1415	   *  COSE/JOSE Algorithms: See Section 8.2.

1417	   *  Detached EAT Bundle Support: DEB use is permitted.

1419	   *  Key Identification: COSE Key ID (kid) is used, where the key ID is
1420	      the hash of a public key (where the public key may be used as a
1421	      raw public key, or in a certificate) as specified in [RFC9679].
1422	      See Section 7.1.1.1 and Section 7.2.1.1 for discussion on the
1423	      choice of hash algorithm.

1425	   *  Endorsement Identification: Optional, but semantics are the same
1426	      as in Verification Key Identification.

1428	   *  Freshness: See Section 9 for details.  When the eat_nonce claim is
1429	      used, the value is a single bstr.

1431	   *  Claims Requirements:

1433	      -  The following claims are required: ueid, oemid, hwmodel,
1434	         hwversion, manifests, and cnf.  See Section 4.3.1 for
1435	         discussion.  Other claims are optional.

1437	      -  See Section 9 for discussion affecting whether the eat_nonce
1438	         claim is used.

1440	      -  The sw-name claim for a Trusted Component holds the URI of the
1441	         SUIT manifest for that component.

1443	      -  The manifests claim uses a SUIT manifest, where the manifest
1444	         body contains a SUIT_Reference as defined in Section 4 of
1445	         [I-D.ietf-suit-report], and the content type is as defined in
1446	         [I-D.ietf-suit-report].

1448	   A TAM implementation might simply accept a TEEP Agent as trustworthy
1449	   based on a successful Attestation Result, and if not then attempt to
1450	   update the TEEP Agent and all of its dependencies.  This logic is
1451	   simple but it might result in updating some components that do not
1452	   need to be updated.

1454	   An alternate TAM implementation might use any Additional Claims to
1455	   determine whether the TEEP Agent or any of its dependencies are
1456	   trustworthy, and only update the specific components that are out of
1457	   date.

1459	5.1.  Relationship to AR4SI

1461	   [I-D.ietf-rats-ar4si] defines an EAT profile for arbitrary Relying
1462	   Parties to use with Attestation Results.  However the TAM as a
1463	   Relying Party needs specific claims that are not required in the
1464	   AR4SI profile, and so needs its own more specific profile.

1466	   In some deployments, a TAM can be used as an intermediary between
1467	   Verifier and a TEEP Agent acting as an Attester in the Passport model
1468	   or acting as a Relying Party in the Background Check Model of
1469	   [RFC9334].  This is depicted in the example in Figure 1.  In such a
1470	   case, both profiles need to be obtained from the Verifier: one for
1471	   use by the TAM itself, and the other to pass on to the TEEP Agent.

1473	   When the TAM and Verifier are combined into the same implementation,
1474	   obtaining both profiles can be straightforward, but when they are on
1475	   different machines, the situation is more complex, especially if
1476	   Nonces are used to ensure freshness of Evidence.  There are thus
1477	   several such cases:

1479	   1.  The protocol between the TAM and the Verifier (which is outside
1480	       the scope of TEEP itself) allows requesting multiple Attestation
1481	       Results from the same Evidence.  In this case, the TAM can
1482	       request both EAT profiles be returned.

1484	   2.  The protocol between the TAM and the Verifier only allows
1485	       requesting one Attestation Result format, but the Evidence
1486	       freshness mechanism does not use Nonces.  In this case, the TAM
1487	       can send the same Evidence in two separate requests, each
1488	       requesting a different EAT profile for the Attestation Results.

1490	   3.  The protocol between the TAM and the Verifier only allows
1491	       requesting one Attestation Result format, and the Evidence
1492	       freshness mechanism uses Nonces.  In this case, it is simpler to
1493	       not have the TAM be an intermediary, since the Verifier will
1494	       require a separate Nonce for each Attestation Result, but have
1495	       the Attester or Relying Party contact the Verifier directly to
1496	       get Attestation Results in the AR4SI profile.

1498	6.  Mapping of TEEP Message Parameters to CBOR Labels

1500	   In COSE, arrays and maps use strings, negative integers, and unsigned
1501	   integers as their keys.  Integers are used for compactness of
1502	   encoding.  Since the word "key" is mainly used in its other meaning,
1503	   as a cryptographic key, this specification uses the term "label" for
1504	   this usage as a map key.

1506	   Message parameter labels are current defined only in the range
1507	   [0..23] to permit encoding as single-byte CBOR unsigned integers,
1508	   providing compact message representation.  Currently, labels 0, 5,
1509	   and 22 are unassigned and reserved for future use.  Extensions that
1510	   define new message parameters SHOULD constrain label values to this
1511	   range.  If future standards require additional messages beyond this
1512	   range, implementations SHOULD be designed to handle gracefully any
1513	   unrecognized labels, treating them as unknown optional parameters
1514	   without failing to process the message.

1516	   This specification uses the following mapping:

1518	                +================================+=======+
1519	                | Name                           | Label |
1520	                +================================+=======+
1521	                | supported-teep-cipher-suites   | 1     |
1522	                +--------------------------------+-------+
1523	                | challenge                      | 2     |
1524	                +--------------------------------+-------+
1525	                | versions                       | 3     |
1526	                +--------------------------------+-------+
1527	                | supported-suit-cose-profiles   | 4     |
1528	                +--------------------------------+-------+
1529	                | selected-version               | 6     |
1530	                +--------------------------------+-------+
1531	                | attestation-payload            | 7     |
1532	                +--------------------------------+-------+
1533	                | tc-list                        | 8     |
1534	                +--------------------------------+-------+
1535	                | ext-list                       | 9     |
1536	                +--------------------------------+-------+
1537	                | manifest-list                  | 10    |
1538	                +--------------------------------+-------+
1539	                | msg                            | 11    |
1540	                +--------------------------------+-------+
1541	                | err-msg                        | 12    |
1542	                +--------------------------------+-------+
1543	                | attestation-payload-format     | 13    |
1544	                +--------------------------------+-------+
1545	                | requested-tc-list              | 14    |
1546	                +--------------------------------+-------+
1547	                | unneeded-manifest-list         | 15    |
1548	                +--------------------------------+-------+
1549	                | component-id                   | 16    |
1550	                +--------------------------------+-------+
1551	                | tc-manifest-sequence-number    | 17    |
1552	                +--------------------------------+-------+
1553	                | have-binary                    | 18    |
1554	                +--------------------------------+-------+
1555	                | suit-reports                   | 19    |
1556	                +--------------------------------+-------+
1557	                | token                          | 20    |
1558	                +--------------------------------+-------+
1559	                | supported-freshness-mechanisms | 21    |
1560	                +--------------------------------+-------+
1561	                | err-lang                       | 22    |
1562	                +--------------------------------+-------+
1563	                | err-code                       | 23    |
1564	                +--------------------------------+-------+

1566	                                 Table 2

1568	   The following CDDL description is used:

1570	   ; labels of mapkey for teep message parameters, uint (0..23)
1571	   supported-teep-cipher-suites = 1
1572	   challenge = 2
1573	   versions = 3
1574	   supported-suit-cose-profiles = 4
1575	   selected-version = 6
1576	   attestation-payload = 7
1577	   tc-list = 8
1578	   ext-list = 9
1579	   manifest-list = 10
1580	   msg = 11
1581	   err-msg = 12
1582	   attestation-payload-format = 13
1583	   requested-tc-list = 14
1584	   unneeded-manifest-list = 15
1585	   component-id = 16
1586	   tc-manifest-sequence-number = 17
1587	   have-binary = 18
1588	   suit-reports = 19
1589	   token = 20
1590	   supported-freshness-mechanisms = 21
1591	   err-lang = 22
1592	   err-code = 23

1594	7.  Behavior Specification

1596	   Behavior is specified in terms of the conceptual APIs defined in
1597	   Section 6.2.1 of [RFC9397].

1599	7.1.  TAM Behavior

1601	   When the ProcessConnect API is invoked, the TAM sends a QueryRequest
1602	   message.

1604	   When the ProcessTeepMessage API is invoked, the TAM first does
1605	   validation as specified in Section 4.1.2, and drops the message if it
1606	   is not valid.  It may also do additional implementation specific
1607	   actions such as logging the results or attempting to update the TEEP
1608	   Agent to a version that does not send invalid messages.  Otherwise,
1609	   it proceeds as follows.

1611	   If the message includes a token, it can be used to match the response
1612	   to a request previously sent by the TAM.  The TAM MUST expire the
1613	   token value after receiving the first response from the device that
1614	   has a valid signature and ignore any subsequent messages that have
1615	   the same token value.  The token value MUST NOT be used for other
1616	   purposes, such as a TAM to identify the devices and/or a device to
1617	   identify TAMs or Trusted Components.

1619	   A TAM implementation that sends multiple concurrent requests to a
1620	   TEEP Agent needs to track outstanding requests and their associated
1621	   tokens.  To prevent unbounded storage of token state, a TAM MUST
1622	   implement a timeout mechanism to eventually discard unanswered
1623	   requests and their tokens.  This timeout SHOULD be configurable, with
1624	   a recommended minimum duration of several hours to account for
1625	   scenarios where devices may take considerable time to process updates
1626	   and resolve dependencies (as noted in Section 7.1, such processing
1627	   may take hours or longer).  A TAM MAY also implement a per-device
1628	   maximum storage limit for outstanding requests, reusing tokens for
1629	   new requests once the per-device limit is reached (after discarding
1630	   the oldest outstanding request).

1632	7.1.1.  Handling a QueryResponse Message

1634	   If a QueryResponse message is received, the TAM verifies the presence
1635	   of any parameters required based on the data-items-requested in the
1636	   QueryRequest, and also validates that the nonce in any SUIT Report
1637	   matches the token sent in the QueryRequest message if a token was
1638	   present.  If these requirements are not met, the TAM drops the
1639	   message and sends an Update message containing an appropriate err-
1640	   code and err-msg.  It may also do additional implementation specific
1641	   actions such as logging the results.  If the requirements are met,
1642	   processing continues as follows.

1644	   If a QueryResponse message is received that contains an attestation-
1645	   payload, the TAM checks whether it contains Evidence or an
1646	   Attestation Result by inspecting the attestation-payload-format
1647	   parameter.  The media type defined in Section 5 indicates an
1648	   Attestation Result, though future extensions might also indicate
1649	   other Attestation Result formats in the future.  Any other
1650	   unrecognized value indicates Evidence.  If it contains an Attestation
1651	   Result, processing continues as in Section 7.1.1.1.

1653	   If the QueryResponse is instead determined to contain Evidence, the
1654	   TAM passes the Evidence (via some mechanism out of scope of this
1655	   document) to an attestation Verifier (see [RFC9334]) to determine
1656	   whether the Agent is in a trustworthy state.  Once the TAM receives
1657	   an Attestation Result from the Verifier, processing continues as in
1658	   Section 7.1.1.1.

1660	7.1.1.1.  Handling an Attestation Result

1662	   The Attestation Result must first be validated as follows:

1664	   1.  Verify that the Attestation Result was signed by a Verifier that
1665	       the TAM trusts.

1667	   2.  Verify that the Attestation Result contains a "cnf" claim (as
1668	       defined in Section 3.1 of [RFC8747]) where the key ID is the hash
1669	       of the TEEP Agent public key used to verify the signature on the
1670	       TEEP message, and the hash is computed using the digest algorithm
1671	       specified by one of the SUIT profiles supported by the TAM.

1673	       See Sections 3.4 and Section 6 of [RFC8747] for more discussion.

1675	   Note: The proof-of-possession functionality for the Attestation
1676	   Result may not be supported by every attestation technology or may
1677	   not be enabled for use in every deployment.

1679	   Based on the results of attestation (if any), any SUIT Reports, and
1680	   the lists of installed, requested, and unneeded Trusted Components
1681	   reported in the QueryResponse, the TAM determines, in any
1682	   implementation specific manner, which Trusted Components need to be
1683	   installed, updated, or deleted, if any.  There are typically three
1684	   cases:

1686	   1.  Attestation failed.  This indicates that the rest of the
1687	       information in the QueryResponse cannot necessarily be trusted,
1688	       as the TEEP Agent may not be healthy (or at least up to date).
1689	       In this case, the TAM might attempt to use TEEP to update any
1690	       Trusted Components (e.g., firmware, the TEEP Agent itself, etc.)
1691	       needed to get the TEEP Agent back into an up-to-date state that
1692	       would allow attestation to succeed.  If the TAM does not have
1693	       permission to update such components (this can happen if
1694	       different TAMs manage different components in the device), the
1695	       TAM instead responds with an Update message containing an
1696	       appropriate err-msg, and err-code set to
1697	       ERR_ATTESTATION_REQUIRED.

1699	   2.  Attestation succeeded (so the QueryResponse information can be
1700	       accepted as valid), but the set of Trusted Components needs to be
1701	       updated based on TAM policy changes or requests from the TEEP
1702	       Agent.

1704	   3.  Attestation succeeded, and no changes are needed.

1706	   If any Trusted Components need to be installed, updated, or deleted,
1707	   the TAM sends an Update message containing SUIT Manifests with
1708	   command sequences to do the relevant installs, updates, or deletes.
1709	   It is important to note that the TEEP Agent's Update Procedure
1710	   requires resolving and installing any dependencies indicated in the
1711	   manifest, which may take some time, and the resulting Success or
1712	   Error message is generated only after completing the Update
1713	   Procedure.  Hence, depending on the freshness mechanism in use, the
1714	   TAM may need to store data (e.g., a nonce) for some time.  For
1715	   example, if a mobile device needs an unmetered connection to download
1716	   a dependency, it may take hours or longer before the device has
1717	   sufficient access.  A different freshness mechanism, such as
1718	   timestamps, might be more appropriate in such cases.

1720	   If no Trusted Components need to be installed, updated, or deleted,
1721	   but the QueryResponse included Evidence, the TAM MAY (e.g., based on
1722	   attestation-payload-format parameters received from the TEEP Agent in
1723	   the QueryResponse) still send an Update message with no SUIT
1724	   Manifests, to pass the Attestation Result back to the TEEP Agent.

1726	7.1.2.  Handling a Success or Error Message

1728	   If a Success or Error message is received containing one or more SUIT
1729	   Reports, the TAM also validates that the nonce in any SUIT Report
1730	   matches the token sent in the Update message, and drops the message
1731	   if it does not match.  Otherwise, the TAM handles the update in any
1732	   implementation specific way, such as updating any locally cached
1733	   information about the state of the TEEP Agent, or logging the
1734	   results.

1736	   If an Error message is received with the error code
1737	   ERR_ATTESTATION_REQUIRED, it indicates that the TEEP Agent is
1738	   requesting attestation of the TAM.  In this case, the TAM MUST send
1739	   another QueryRequest with an attestation-payload and optionally a
1740	   suit-report to the TEEP Agent.

1742	   If any other Error message is received, the TAM can handle it in any
1743	   implementation specific way, but Section 4.6 provides recommendations
1744	   for such handling.

1746	7.2.  TEEP Agent Behavior

1748	   When the RequestTA API is invoked, the TEEP Agent first checks
1749	   whether the requested TA is already installed.  If it is already
1750	   installed, the TEEP Agent passes no data back to the caller.
1751	   Otherwise, if the TEEP Agent chooses to initiate the process of
1752	   requesting the indicated TA, it determines (in any implementation
1753	   specific way) the TAM URI based on any TAM URI provided by the
1754	   RequestTA caller and any local configuration, and passes back the TAM
1755	   URI to connect to.  It MAY also pass back a QueryResponse message if
1756	   all of the following conditions are true:

1758	   *  The last QueryRequest message received from that TAM contained no
1759	      token or challenge,

1761	   *  The ProcessError API was not invoked for that TAM since the last
1762	      QueryResponse message was received from it, and

1764	   *  The public key or certificate of the TAM is cached and not
1765	      expired.

1767	   When the RequestPolicyCheck API is invoked, the TEEP Agent decides
1768	   whether to initiate communication with any trusted TAMs (e.g., it
1769	   might choose to do so for a given TAM unless it detects that it has
1770	   already communicated with that TAM recently).  If so, it passes back
1771	   a TAM URI to connect to.  If the TEEP Agent has multiple TAMs it
1772	   needs to connect with, it just passes back one, with the expectation
1773	   that RequestPolicyCheck API will be invoked to retrieve each one
1774	   successively until there are no more and it can pass back no data at
1775	   that time.  Thus, once a TAM URI is returned, the TEEP Agent can
1776	   remember that it has already initiated communication with that TAM.

1778	   When the ProcessError API is invoked, the TEEP Agent can handle it in
1779	   any implementation specific way, such as logging the error or using
1780	   the information in future choices of TAM URI.

1782	   When the ProcessTeepMessage API is invoked, the Agent first does
1783	   validation as specified in Section 4.1.2, and if it is not valid then
1784	   the Agent responds with an Error message.  Otherwise, processing
1785	   continues as follows based on the type of message.

1787	7.2.1.  Handling a QueryRequest Message

1789	   When a QueryRequest message is received, it is processed as follows.

1791	   If the TEEP Agent requires attesting the TAM and the QueryRequest
1792	   message did not contain an attestation-payload, the TEEP Agent MUST
1793	   send an Error Message with the error code ERR_ATTESTATION_REQUIRED
1794	   supplying the supported-freshness-mechanisms and challenge if needed.
1795	   Otherwise, processing continues as follows.

1797	   If the TEEP Agent requires attesting the TAM and the QueryRequest
1798	   message did contain an attestation-payload, the TEEP Agent checks
1799	   whether it contains Evidence or an Attestation Result by inspecting
1800	   the attestation-payload-format parameter.  The media type defined in
1801	   Section 5 indicates an Attestation Result, though future extensions
1802	   might also indicate other Attestation Result formats in the future.
1803	   Any other unrecognized value indicates Evidence.  If it contains an
1804	   Attestation Result, processing continues as in Section 7.2.1.1.

1806	   If the QueryRequest is instead determined to contain Evidence, the
1807	   TEEP Agent passes the Evidence (via some mechanism out of scope of
1808	   this document) to an attestation Verifier (see [RFC9334]) to
1809	   determine whether the TAM is in a trustworthy state.  Once the TEEP
1810	   Agent receives an Attestation Result from the Verifier, processing
1811	   continues as in Section 7.2.1.1.

1813	   The TEEP Agent MAY also use (in any implementation specific way) any
1814	   SUIT Reports in the QueryRequest in determining whether it trusts the
1815	   TAM.  If a SUIT Report uses a suit-cose-profile that the TEEP Agent
1816	   does not support, then the TEEP Agent MUST send an Error Message with
1817	   the error code ERR_UNSUPPORTED_SUIT_REPORT supplying the supported-
1818	   suit-cose-profiles.  Otherwise, processing continues as follows.

1820	   Once the Attestation Result is handled, or if the TEEP Agent does not
1821	   require attesting the TAM, the Agent responds with a QueryResponse
1822	   message if all fields were understood, or an Error message if any
1823	   error was encountered.

1825	7.2.1.1.  Handling an Attestation Result

1827	   The Attestation Result must first be validated as follows:

1829	   1.  Verify that the Attestation Result was signed by a Verifier that
1830	       the TEEP Agent trusts.

1832	   2.  Verify that the Attestation Result contains a "cnf" claim (as
1833	       defined in Section 3.1 of [RFC8747]) where the key ID is the hash
1834	       of the TAM public key used to verify the signature on the TEEP
1835	       message, and the hash is computed using the Digest Algorithm
1836	       specified by one of the SUIT profiles supported by the TEEP
1837	       Agent.

1839	       See Sections 3.4 and Section 6 of [RFC8747] for more discussion.

1841	7.2.2.  Handling an Update Message

1843	   When an Update message is received, the Agent attempts to unlink any
1844	   SUIT manifests listed in the unneeded-manifest-list field of the
1845	   message, and responds with an Error message if any error was
1846	   encountered.  If the unneeded-manifest-list was empty, or no error
1847	   was encountered processing it, the Agent attempts to update the
1848	   Trusted Components specified in the SUIT manifests by following the
1849	   Update Procedure specified in [I-D.ietf-suit-manifest], and responds
1850	   with a Success message if all SUIT manifests were successfully
1851	   installed, or an Error message if any error was encountered.  It is
1852	   important to note that the Update Procedure requires resolving and
1853	   installing any dependencies indicated in the manifest, which may take
1854	   some time, and the Success or Error message is generated only after
1855	   completing the Update Procedure.

1857	8.  Cipher Suites

1859	   TEEP requires algorithms for various purposes:

1861	   *  Algorithms for signing TEEP messages exchanged between the TEEP
1862	      Agent and the TAM.

1864	   *  Algorithms for signing EAT-based Evidence sent by the Attester via
1865	      the TEEP Agent and the TAM to the Verifier.

1867	   *  Algorithms for encrypting EAT-based Evidence sent by the TEEP
1868	      Agent to the TAM.  (The TAM will decrypt the encrypted Evidence
1869	      and will forward it to the Verifier.)

1871	   *  Algorithms for signing and optionally encrypting SUIT reports sent
1872	      by the TEEP Agent to the TAM.

1874	   *  Algorithms for signing and optionally encrypting SUIT manifests
1875	      sent by the Trusted Component Signer to the TEEP Agent.

1877	   Further details are provided for the protection of TEEP messages,
1878	   SUIT Reports, and EATs.

1880	8.1.  TEEP Messages

1882	   The TEEP protocol uses COSE for protection of TEEP messages in both
1883	   directions.  To negotiate cryptographic mechanisms and algorithms,
1884	   the TEEP protocol defines the following cipher suite structure, which
1885	   is used to specify an ordered set of operations (e.g., sign) done as
1886	   part of composing a TEEP message.  Although this specification only
1887	   specifies the use of signing and relies on payload encryption to
1888	   protect sensitive information, future extensions might specify
1889	   support for encryption and/or MAC operations if needed.

1891	   ; teep-cipher-suites
1892	   $teep-cipher-suite /= teep-cipher-suite-sign1-ed25519
1893	   $teep-cipher-suite /= teep-cipher-suite-sign1-esp256

1895	   ;The following two cipher suites have only a single operation each.
1896	   ;Other cipher suites may be defined to have multiple operations.
1897	   ;It is mandatory for TAM to support them, and optional
1898	   ;to support any additional ones that use COSE_Sign_Tagged, or other
1899	   ;signing, encryption, or MAC algorithms.

1901	   teep-operation-sign1-ed25519 = [ cose-sign1, cose-alg-ed25519 ]
1902	   teep-operation-sign1-esp256  = [ cose-sign1, cose-alg-esp256 ]

1904	   teep-cipher-suite-sign1-ed25519 = [ teep-operation-sign1-ed25519 ]
1905	   teep-cipher-suite-sign1-esp256  = [ teep-operation-sign1-esp256 ]

1907	   ;Mandatory for TAM and TEEP Agent to support the following COSE
1908	   ;operations, and optional to support additional ones such as
1909	   ;COSE_Sign_Tagged, COSE_Encrypt0_Tagged, etc.

1911	   cose-sign1 = 18      ; CoAP Content-Format value

1913	   ;Mandatory for TAM to support the following, and optional to
1914	   ;implement any additional algorithms from the IANA COSE Algorithms
1915	   ;registry.

1917	   cose-alg-esp256  = -9   ; ECDSA using P-256 curve and SHA-256
1918	   cose-alg-ed25519 = -19  ; EdDSA using Ed25519 curve

1920	   Each operation in a given cipher suite has two elements:

1922	   *  a COSE-type defined in Section 2 of [RFC9052] that identifies the
1923	      type of operation, and

1925	   *  a specific cryptographic algorithm as defined in the COSE
1926	      Algorithms registry [COSE.Algorithm] to be used to perform that
1927	      operation.

1929	   A TAM MUST support both of the cipher suites defined above.  A TEEP
1930	   Agent MUST support at least one of the two but can choose which one.
1931	   For example, a TEEP Agent might choose a given cipher suite if it has
1932	   hardware support for it.  A TAM or TEEP Agent MAY also support any
1933	   other algorithms in the COSE Algorithms registry in addition to the
1934	   mandatory ones listed above.  It MAY also support use with COSE_Sign
1935	   or other COSE types in additional cipher suites.

1937	   Any cipher suites without confidentiality protection can only be
1938	   added if the associated specification includes a discussion of
1939	   security considerations and applicability, since manifests may carry
1940	   sensitive information.  For example, Section 6 of [RFC9397] permits
1941	   implementations that terminate transport security inside the TEE and
1942	   if the transport security provides confidentiality then additional
1943	   encryption might not be needed in the manifest for some use cases.
1944	   For most use cases, however, manifest confidentiality will be needed
1945	   to protect sensitive fields from the TAM as discussed in Section 9.8
1946	   of [RFC9397].

1948	   The cipher suites defined above do not do encryption at the TEEP
1949	   layer, but permit encryption of the SUIT payload using a mechanism
1950	   such as [I-D.ietf-suit-firmware-encryption].  See Section 10 and
1951	   Section 8.2 for more discussion of specific payloads.

1953	   For the initial QueryRequest message, unless the TAM has more
1954	   specific knowledge about the TEEP Agent (e.g., if the QueryRequest is
1955	   sent in response to some underlying transport message that contains a
1956	   hint), the message does not use COSE_Sign1 with one of the above
1957	   cipher suites, but instead uses COSE_Sign with multiple signatures,
1958	   one for each algorithm used in any of the cipher suites listed in the
1959	   supported-teep-cipher-suites parameter of the QueryRequest, so that a
1960	   TEEP Agent supporting any one of them can verify a signature.  If the
1961	   TAM does have specific knowledge about which cipher suite the TEEP
1962	   Agent supports, it MAY instead use that cipher suite with the
1963	   QueryRequest.

1965	   For an Error message with code ERR_UNSUPPORTED_CIPHER_SUITES, the
1966	   TEEP Agent MUST protect it with any of the cipher suites mandatory
1967	   for the TAM.

1969	   For all other TEEP messages between the TAM and TEEP Agent, the
1970	   selected TEEP cipher suite MUST be used in both directions.

1972	8.2.  EATs and SUIT Reports

1974	   TEEP uses COSE for confidentiality of EATs and SUIT Reports sent by a
1975	   TEEP Agent.  The TEEP Agent obtains a signed EAT and then SHOULD
1976	   encrypt it using the TAM as the recipient, unless the transport layer
1977	   provides sufficient confidentiality protection or the TEEP Agent's
1978	   deployment environment does not permit access to the TAM's public
1979	   key.  A SUIT Report is created by a SUIT processor, which is part of
1980	   the TEEP Agent itself.  The TEEP Agent is therefore in control of
1981	   signing the SUIT Report and SHOULD encrypt it for the same reasons,
1982	   to protect sensitive information from intermediate processors and
1983	   transport mechanisms.  Again, the TAM is the recipient of the
1984	   encrypted content.  For content-key distribution Ephemeral-Static
1985	   Diffie-Hellman (ES-DH) is used in this specification.  See
1986	   Section 8.5.5 and Appendix B of [RFC9052] for more details.  (If
1987	   [I-D.ietf-suit-firmware-encryption] is used, it is also the same as
1988	   discussed in Section 6.2 of that document.)

1990	   ES-DH is a scheme that provides public key encryption given a
1991	   recipient's public key.  Hence, the TEEP Agent needs to be in
1992	   possession of the public key of the TAM.  See Section 5 of [RFC9397]
1993	   for more discussion of TAM keys used by the TEEP Agent.  There are
1994	   multiple variants of this scheme; this document uses the variant
1995	   specified in Section 8.5.5 of [RFC9052].

1997	   The following two layer structure is used:

1999	   *  Layer 0: Has a content encrypted with the Content Encryption Key
2000	      (CEK), a symmetric key.  For encrypting SUIT Reports and EATs the
2001	      content MUST NOT be detached.

2003	   *  Layer 1: Uses the AES Key Wrap algorithm to encrypt the randomly
2004	      generated CEK with the Key Encryption Key (KEK) derived with ES-
2005	      DH, whereby the resulting symmetric key is fed into the HKDF-based
2006	      key derivation function.

2008	   As a result, the two layers combine ES-DH with AES-KW and HKDF.

2010	   This document reuses the CDDL defined in Section 6.2.3 of
2011	   [I-D.ietf-suit-firmware-encryption] and the context information
2012	   structure defined in Section 6.2.4 of
2013	   [I-D.ietf-suit-firmware-encryption] although with an important
2014	   modification.  The COSE_KDF_Context.SuppPubInfo.other value MUST be
2015	   set to "SUIT Report Encryption" when a SUIT Report is encrypted and
2016	   MUST be set to "EAT Encryption" when an EAT is encrypted.  The
2017	   COSE_KDF_Context.SuppPubInfo.other field captures the protocol in
2018	   which the ES-DH content key distribution algorithm is used.

2020	   This specification defines cipher suites for confidentiality
2021	   protection of EATs and SUIT Reports.  The TAM MUST support each
2022	   cipher suite defined below, based on definitions in
2023	   [I-D.ietf-suit-mti].  A TEEP Agent MUST support at least one of the
2024	   cipher suites below but can choose which one.  For example, a TEEP
2025	   Agent might choose a given cipher suite if it has hardware support
2026	   for it.  A TAM or TEEP Agent MAY also support other algorithms in the
2027	   COSE Algorithms registry.  It MAY also support use with COSE_Encrypt
2028	   or other COSE types in additional cipher suites.

2030	   ; suit-cose-profile
2031	   $suit-cose-profile /= suit-sha256-esp256-ecdh-a128ctr
2032	   $suit-cose-profile /= suit-sha256-ed25519-ecdh-a128ctr
2033	   $suit-cose-profile /= suit-sha256-esp256-ecdh-a128gcm
2034	   $suit-cose-profile /= suit-sha256-ed25519-ecdh-chacha-poly

2036	9.  Attestation Freshness Mechanisms

2038	   A freshness mechanism determines how a TAM can tell whether an
2039	   attestation payload provided in a QueryResponse is fresh.  There are
2040	   multiple ways this can be done as discussed in Section 10 of
2041	   [RFC9334].

2043	   Each freshness mechanism is identified with an integer value, which
2044	   corresponds to an IANA registered freshness mechanism (see the IANA
2045	   Considerations section of
2046	   [I-D.ietf-rats-reference-interaction-models]).  This document uses
2047	   the following freshness mechanisms which may be added to in the
2048	   future by TEEP extensions:

2050	   ; freshness-mechanisms
2051	   FRESHNESS_NONCE = 0
2052	   FRESHNESS_TIMESTAMP = 1

2054	   $freshness-mechanism /= FRESHNESS_NONCE
2055	   $freshness-mechanism /= FRESHNESS_TIMESTAMP

2057	   An implementation MUST support the Nonce mechanism and MAY support
2058	   additional mechanisms.

2060	   In the Nonce mechanism, the attestation payload MUST include a nonce
2061	   provided in the QueryRequest challenge if the Background Check model
2062	   is used, or in the QueryRequest token if the Passport model is used.
2063	   The timestamp mechanism uses a timestamp determined via mechanisms
2064	   outside the TEEP protocol, and the challenge is only needed in the
2065	   QueryRequest message if a challenge is needed in generating the
2066	   attestation payload for reasons other than freshness.

2068	   If a TAM supports multiple freshness mechanisms that require
2069	   different challenge formats, the QueryRequest message can currently
2070	   only send one such challenge.  This situation is expected to be rare,
2071	   but should it occur, the TAM can choose to prioritize one of them and
2072	   exclude the other from the supported-freshness-mechanisms in the
2073	   QueryRequest, and resend the QueryRequest with the other mechanism if
2074	   an ERR_UNSUPPORTED_FRESHNESS_MECHANISMS Error is received that
2075	   indicates the TEEP Agent supports the other mechanism.

2077	10.  Security Considerations

2079	   This section summarizes the security considerations discussed in this
2080	   specification:

2082	   Cryptographic Algorithms
2083	      TEEP protocol messages exchanged between the TAM and the TEEP
2084	      Agent are protected using COSE.  This specification relies on the
2085	      cryptographic algorithms provided by COSE.  Public key based
2086	      authentication is used by the TEEP Agent to authenticate the TAM
2087	      and vice versa.

2089	   Attestation
2090	      A TAM relies on signed Attestation Results provided by a Verifier,
2091	      either obtained directly using a mechanism outside the TEEP
2092	      protocol (by using some mechanism to pass Evidence obtained in the
2093	      attestation payload of a QueryResponse, and getting back the
2094	      Attestation Results), or indirectly via the TEEP Agent forwarding
2095	      the Attestation Results in the attestation payload of a
2096	      QueryResponse.  See the security considerations of the specific
2097	      mechanism in use (e.g., EAT) for more discussion.

2099	      An impersonation attack, where one TEEP Agent attempts to use the
2100	      attestation payload of another TEEP Agent, can be prevented using
2101	      a proof-of-possession approach.  The "cnf" claim is mandatory in
2102	      the EAT profile for EAT for this purpose.  See Section 6 of
2103	      [RFC8747] and Section 7.1.1.1 and Section 7.2.1.1 of this document
2104	      for more discussion.

2106	   Trusted Component Binaries
2107	      Each Trusted Component binary is signed by a Trusted Component
2108	      Signer.  It is the responsibility of the TAM to relay only
2109	      verified Trusted Components from authorized Trusted Component
2110	      Signers.  Delivery of a Trusted Component to the TEEP Agent is
2111	      then the responsibility of the TAM, using the security mechanisms
2112	      provided by the TEEP protocol.  To protect the Trusted Component
2113	      binary, the SUIT manifest format is used and it offers a variety
2114	      of security features, including digital signatures and content
2115	      encryption, if a SUIT mechanism such as
2116	      [I-D.ietf-suit-firmware-encryption] is used.

2118	   Personalization Data
2119	      A Trusted Component Signer or TAM can supply personalization data
2120	      along with a Trusted Component.  This data is also protected by a
2121	      SUIT manifest.  Personalization data is signed and encrypted by a
2122	      Trusted Component Signer, if a SUIT mechanism such as
2123	      [I-D.ietf-suit-firmware-encryption] is used.

2125	   TEEP Broker
2126	      As discussed in Section 6 of [RFC9397], the TEEP protocol
2127	      typically relies on a TEEP Broker to relay messages between the
2128	      TAM and the TEEP Agent.  When the TEEP Broker is compromised, it
2129	      can drop messages, delay the delivery of messages, and replay
2130	      messages, but it cannot modify those messages.  (A replay would
2131	      be, however, detected by the TEEP Agent.)  A compromised TEEP
2132	      Broker could reorder messages in an attempt to install an old
2133	      version of a Trusted Component.  Information in the manifest
2134	      ensures that TEEP Agents are protected against such downgrade
2135	      attacks based on features offered by the manifest itself.

2137	   Replay Protection
2138	      The TEEP protocol supports replay protection as follows.  The
2139	      transport protocol under the TEEP protocol might provide replay
2140	      protection, but may be terminated in the TEEP Broker which is not
2141	      trusted by the TEEP Agent and so the TEEP protocol does replay
2142	      protection itself.  If attestation of the TAM is used, the
2143	      attestation freshness mechanism provides replay protection for
2144	      attested QueryRequest messages.  If non-attested QueryRequest
2145	      messages are replayed, the TEEP Agent will generate QueryResponse
2146	      or Error messages, but the REE can already conduct Denial of
2147	      Service attacks against the TEE and/or the TAM even without the
2148	      TEEP protocol.  QueryResponse messages have replay protection via
2149	      attestation freshness mechanism, or the token field in the message
2150	      if attestation is not used.  Update messages have replay
2151	      protection via the suit-manifest-sequence-number (see
2152	      Section 8.4.2 of [I-D.ietf-suit-manifest]).  Error and Success
2153	      messages have replay protection via SUIT Reports and/or the token
2154	      field in the message, where a TAM can detect which message it is
2155	      in response to.

2157	   Trusted Component Signer Compromise
2158	      A TAM is responsible for vetting Trusted Components before
2159	      distributing them to TEEP Agents.  It is RECOMMENDED to provide a
2160	      way to update the trust anchor store used by the TEE, for example
2161	      using a firmware update mechanism such as
2162	      [I-D.ietf-rats-concise-ta-stores].  Thus, if a Trusted Component
2163	      Signer is later compromised, the TAM can update the trust anchor
2164	      store used by the TEE, for example using a firmware update
2165	      mechanism.

2167	   CA Compromise
2168	      The CA issuing certificates to a TEE or a Trusted Component Signer
2169	      might get compromised.  It is RECOMMENDED to provide a way to
2170	      update the trust anchor store used by the TEE, for example by
2171	      using a firmware update mechanism, Concise TA Stores
2172	      [I-D.ietf-rats-concise-ta-stores], Trust Anchor Management
2173	      Protocol (TAMP) [RFC5934] or a similar mechanism.  If the CA
2174	      issuing certificates to devices gets compromised then these
2175	      devices will be rejected by a TAM, if revocation is available to
2176	      the TAM.

2178	   TAM Certificate Expiry
2179	      The integrity and the accuracy of the clock within the TEE
2180	      determines the ability to determine an expired TAM certificate, if
2181	      certificates are used.

2183	   Compromised Time Source
2184	      As discussed above, certificate validity checks rely on comparing
2185	      validity dates to the current time, which relies on having a
2186	      trusted source of time, such as [RFC8915].  A compromised time
2187	      source could thus be used to subvert such validity checks.

2189	10.1.  Operational Considerations

2191	   This section summarizes operational and management guidance for
2192	   deployments using the TEEP protocol.  It complements the general
2193	   operational guidelines in the IETF operations-area document
2194	   [I-D.ietf-opsawg-rfc5706bis] and refers implementers to the
2195	   architecture and conceptual APIs in [RFC9397] for configuration and
2196	   management points.

2198	   *  Configuration and placement: Protocol-specific configuration is
2199	      typically performed in the TAM, the TEEP Agent, and any Verifier
2200	      used by the TAM.  See the conceptual APIs in [RFC9397] for the
2201	      configuration points exposed by implementations (e.g., which
2202	      Trusted Components to manage, trust anchors, and per-device
2203	      state).

2205	   *  Token lifecycle and state management: Tokens are used to match
2206	      requests and responses and to provide limited replay protection.
2207	      The guidance in this document requires random initial tokens and
2208	      non-reuse; implementers MUST ensure bounded storage of outstanding
2209	      tokens (timeouts, per-device caps) and MUST expire tokens after
2210	      the first valid response.  Operational deployments SHOULD tune
2211	      token timeouts to accommodate device processing time (see
2212	      Section 7.1).

2214	   *  Key and certificate lifecycle: Operators MUST run procedures for
2215	      certificate and key issuance, rollover, revocation, and timely
2216	      renewal.  Implementations SHOULD support certificate status checks
2217	      and have clear behavior when certificates are expired or revoked
2218	      (see err-code behaviors such as ERR_CERTIFICATE_EXPIRED and
2219	      ERR_BAD_CERTIFICATE).

2221	   *  Logging, monitoring, and diagnostics: Implementations SHOULD log
2222	      operational events, but MUST avoid placing sensitive data (e.g.,
2223	      raw Evidence, private keys) into logs.  Diagnostic fields, such as
2224	      err-msg (optionally accompanied by err-lang), are intended for
2225	      human operators; logs should capture structured error codes and
2226	      minimal diagnostic text to aid incident response.

2228	   *  Rate limiting and DoS protection: Implementations SHOULD apply
2229	      rate limits and backoff policies to mitigate malformed or high-
2230	      volume requests.  Agents SHOULD limit the size and number of
2231	      concurrent manifests processed and protect local resources (CPU,
2232	      memory, storage) from exhausting.

2234	   *  Time synchronization: Accurate device time is important for
2235	      certificate validity checks and for some attestation freshness
2236	      mechanisms.  Operators SHOULD ensure devices maintain adequate
2237	      time synchronization.

2239	   *  Privacy and data minimization Attestation results, SUIT reports,
2240	      and system-property-claims can contain identifying information.
2241	      Do not expose such data to unauthorised parties; apply least-
2242	      privilege principles when requesting or returning attestation or
2243	      component lists.

2245	   *  Upgrade and rollback procedures: Manifest processing can be
2246	      disruptive.  Operators SHOULD plan for safe upgrade and rollback
2247	      procedures, including verification of manifests prior to
2248	      execution, mechanisms for retry, and consideration of partial
2249	      failure modes.

2251	   *  Transport and deployment-specific concerns: TEEP is transport
2252	      agnostic; operators MUST ensure the chosen transport provides
2253	      adequate confidentiality, integrity, authentication, and replay
2254	      protection.  See the HTTP binding draft
2255	      [I-D.ietf-teep-otrp-over-http] for transport-specific operational
2256	      details when that binding is used.

2258	   *  Scaling and batching: Large-scale deployments SHOULD consider
2259	      batching updates and asynchronous workflows to avoid overwhelming
2260	      devices or management servers.  Unsolicited messages and polling
2261	      behavior should be chosen to balance timeliness and operational
2262	      load.

2264	   *  Emergency recovery: Provide procedures for emergency recovery,
2265	      including factory-reset processes, certificate revocation
2266	      handling, and operational steps for devices that become non-
2267	      responsive after updates.

2269	   Where operational considerations are covered by other documents (for
2270	   example, the TEEP architecture [RFC9397]), implementers SHOULD follow
2271	   the guidance in those documents as applicable.

2273	11.  Transport Considerations

2275	   This specification defines the TEEP protocol as a set of messages to
2276	   be exchanged between a TAM and a TEEP Agent.  However, this
2277	   specification is transport-agnostic and does not mandate use of a
2278	   specific transport protocol.  The TEEP protocol messages are signed
2279	   and can be optionally encrypted at the protocol layer, providing end-
2280	   to-end security independent of the underlying transport.

2282	   Companion specifications define how TEEP messages are transported
2283	   over specific protocols.  For example, [I-D.ietf-teep-otrp-over-http]
2284	   defines how TEEP messages are transported over HTTP/HTTPS.  TEEP
2285	   transport specifications MUST provide the following information:

2287	   *  Whether the transport provides reliability guarantees and ordered
2288	      delivery

2290	   *  How message loss and retransmission are handled

2292	   *  Recovery mechanisms for mid-transaction transport failures

2294	   *  How the transport handles duplicate messages and idempotency

2296	   *  How transport-layer errors are reported to the TEEP Agent and TAM

2298	   Implementations SHOULD use a transport that provides authentication
2299	   of the remote endpoint and confidentiality protection of messages in
2300	   flight, or provide these protections at the TEEP protocol layer.  As
2301	   discussed in [RFC9397], the TEEP protocol uses end-to-end
2302	   cryptographic protection via COSE to ensure that messages cannot be
2303	   modified by intermediaries, such as the TEEP Broker.

2305	   The token field in TEEP messages (present in QueryRequest and Update
2306	   messages) is used for request-response matching.  As described in
2307	   Section 7.1, the token MUST be unique among outstanding requests for
2308	   a given device at a given TAM, but tokens MAY be reused for new
2309	   requests once the previous request has received a response or timed
2310	   out.  Token reuse across multiple devices or TAMs is permitted but
2311	   not required; implementations MAY choose to make tokens globally
2312	   unique for audit or logging purposes.

2314	12.  Privacy Considerations

2316	   Depending on the properties of the attestation mechanism, it is
2317	   possible to uniquely identify a device based on information in the
2318	   attestation payload or in the certificate used to sign the
2319	   attestation payload.  This uniqueness may raise privacy concerns.  To
2320	   lower the privacy implications, the TEEP Agent MUST present its
2321	   attestation payload only to an authenticated and authorized TAM and,
2322	   when using an EAT, it SHOULD use encryption as discussed in [RFC9711]
2323	   unless the transport layer provides sufficient confidentiality
2324	   protection.  Encryption is particularly important since
2325	   confidentiality is not provided by the TEEP protocol itself and the
2326	   transport protocol under the TEEP protocol might be implemented
2327	   outside of any TEE.  If any mechanism other than EAT is used, that
2328	   mechanism MUST specify how privacy is provided.

2330	   Since SUIT Reports can also contain sensitive information, a TEEP
2331	   Agent SHOULD also encrypt SUIT Reports as discussed in Section 8.2,
2332	   particularly when they contain device identifiers or other sensitive
2333	   operational data.

2335	   In addition, in the usage scenario discussed in Section 4.4.1, a
2336	   device reveals its IP address to the Trusted Component Binary server.
2337	   This can reveal to that server at least a clue as to its location,
2338	   which might be sensitive information in some cases.

2340	   EATs and SUIT Reports from a TAM can also be present in a
2341	   QueryRequest.  Typically, the ability to uniquely identify a TAM is
2342	   less of a concern than it is for TEEP Agents, but where
2343	   confidentiality is a concern for the TAM, such EATs and SUIT Reports
2344	   SHOULD be encrypted just like ones from TEEP Agents.

2346	13.  IANA Considerations

2348	13.1.  Media Type Registration

2350	   IANA is requested to assign a media type for application/teep+cbor.

2352	   Type name:  application

2354	   Subtype name:  teep+cbor

2356	   Required parameters:  none

2358	   Optional parameters:  none

2360	   Encoding considerations:  Same as encoding considerations of
2361	      application/cbor.

2363	   Security considerations:  See Security Considerations Section of this
2364	      document.

2366	   Interoperability considerations:  Same as interoperability
2367	      considerations of application/cbor as specified in [RFC8949].

2369	   Published specification:  This document.

2371	   Applications that use this media type:  TEEP protocol implementations

2373	   Fragment identifier considerations:  N/A

2375	   Additional information:
2376	      *  Deprecated alias names for this type: N/A

2378	      *  Magic number(s): N/A

2380	      *  File extension(s): N/A

2382	      *  Macintosh file type code(s): N/A

2384	   Person to contact for further information:  teep@ietf.org

2386	   Intended usage:  COMMON

2388	   Restrictions on usage:  none

2390	   Author:  See the "Authors' Addresses" section of this document

2392	   Change controller:  IETF

2394	13.2.  TEEP Message Type Registry

2396	   IANA is requested to create a new registry titled "TEEP Message
2397	   Types" within the TEEP registry.  The registry has the following
2398	   format:

2400	           +=======+===========================+===============+
2401	           | Value | Name                      | Reference     |
2402	           +=======+===========================+===============+
2403	           | 0     | (Reserved)                | This document |
2404	           +-------+---------------------------+---------------+
2405	           | 1     | TEEP-TYPE-query-request   | This document |
2406	           +-------+---------------------------+---------------+
2407	           | 2     | TEEP-TYPE-query-response  | This document |
2408	           +-------+---------------------------+---------------+
2409	           | 3     | TEEP-TYPE-update          | This document |
2410	           +-------+---------------------------+---------------+
2411	           | 4     | (Reserved)                | This document |
2412	           +-------+---------------------------+---------------+
2413	           | 5     | TEEP-TYPE-success         | This document |
2414	           +-------+---------------------------+---------------+
2415	           | 6     | TEEP-TYPE-error           | This document |
2416	           +-------+---------------------------+---------------+
2417	           | 7-23  | (Reserved for future use) | This document |
2418	           +-------+---------------------------+---------------+

2420	                                  Table 3

2422	   Registry values are not required to be contiguous; reserved values
2423	   allow future extensions without renumbering.

2425	   Registration procedures are as follows:

2427	   *  0-12: Standards Action

2429	   *  13-23: Specification Required

2431	13.3.  data-item-requested Bitmap Registry

2433	   IANA is requested to create a registry titled "TEEP data-item-
2434	   requested Bits" within the TEEP registry.  The registry has the
2435	   following format:

2437	     +======+====================+=======================+===========+
2438	     | Bit  | Name               | Description           | Reference |
2439	     +======+====================+=======================+===========+
2440	     | 0    | attestation        | TAM requests          | This      |
2441	     |      |                    | attestation payload   | document  |
2442	     +------+--------------------+-----------------------+-----------+
2443	     | 1    | trusted-components | TAM queries installed | This      |
2444	     |      |                    | Trusted Components    | document  |
2445	     +------+--------------------+-----------------------+-----------+
2446	     | 2    | extensions         | TAM queries supported | This      |
2447	     |      |                    | extensions            | document  |
2448	     +------+--------------------+-----------------------+-----------+
2449	     | 3    | suit-reports       | TAM requests SUIT     | This      |
2450	     |      |                    | Reports               | document  |
2451	     +------+--------------------+-----------------------+-----------+
2452	     | 4-31 | (Reserved for      |                       | This      |
2453	     |      | future use)        |                       | document  |
2454	     +------+--------------------+-----------------------+-----------+

2456	                                  Table 4

2458	   Registration procedures are as follows:

2460	   *  0-23: Standards Action

2462	   *  24-31: Specification Required

2464	13.4.  TEEP Error Code Registry

2466	   IANA is requested to create a registry titled "TEEP Error Codes"
2467	   within the TEEP registry.  The registry has the following format:

2469	   +=====+====================================+==============+=========+
2470	   |Value|Name                                | Description  |Reference|
2471	   +=====+====================================+==============+=========+
2472	   |0    |(Reserved)                          | Reserved to  |This     |
2473	   |     |                                    | prevent      |document |
2474	   |     |                                    | accidental   |         |
2475	   |     |                                    | use          |         |
2476	   +-----+------------------------------------+--------------+---------+
2477	   |1    |ERR_PERMANENT_ERROR                 | Incorrect or |This     |
2478	   |     |                                    | inconsistent |document |
2479	   |     |                                    | fields       |         |
2480	   +-----+------------------------------------+--------------+---------+
2481	   |2    |ERR_UNSUPPORTED_EXTENSION           | Unsupported  |This     |
2482	   |     |                                    | extension in |document |
2483	   |     |                                    | message      |         |
2484	   +-----+------------------------------------+--------------+---------+
2485	   |3    |ERR_UNSUPPORTED_FRESHNESS_MECHANISMS| Unsupported  |This     |
2486	   |     |                                    | freshness    |document |
2487	   |     |                                    | mechanism    |         |
2488	   +-----+------------------------------------+--------------+---------+
2489	   |4    |ERR_UNSUPPORTED_MSG_VERSION         | Unsupported  |This     |
2490	   |     |                                    | TEEP         |document |
2491	   |     |                                    | protocol     |         |
2492	   |     |                                    | version      |         |
2493	   +-----+------------------------------------+--------------+---------+
2494	   |5    |ERR_UNSUPPORTED_CIPHER_SUITES       | Unsupported  |This     |
2495	   |     |                                    | cipher       |document |
2496	   |     |                                    | suites       |         |
2497	   +-----+------------------------------------+--------------+---------+
2498	   |6    |ERR_BAD_CERTIFICATE                 | Certificate  |This     |
2499	   |     |                                    | processing   |document |
2500	   |     |                                    | failed       |         |
2501	   +-----+------------------------------------+--------------+---------+
2502	   |7    |ERR_ATTESTATION_REQUIRED            | Attestation  |This     |
2503	   |     |                                    | is required  |document |
2504	   +-----+------------------------------------+--------------+---------+
2505	   |8    |ERR_UNSUPPORTED_SUIT_REPORT         | Unsupported  |This     |
2506	   |     |                                    | SUIT Report  |document |
2507	   |     |                                    | profile      |         |
2508	   +-----+------------------------------------+--------------+---------+
2509	   |9    |ERR_CERTIFICATE_EXPIRED             | Certificate  |This     |
2510	   |     |                                    | has expired  |document |
2511	   |     |                                    | or is        |         |
2512	   |     |                                    | invalid      |         |
2513	   +-----+------------------------------------+--------------+---------+
2514	   |10   |ERR_TEMPORARY_ERROR                 | Temporary    |This     |
2515	   |     |                                    | error (e.g., |document |
2516	   |     |                                    | memory       |         |
2517	   |     |                                    | allocation)  |         |
2518	   +-----+------------------------------------+--------------+---------+
2519	   |11-16|(Reserved for future use)           |              |         |
2520	   +-----+------------------------------------+--------------+---------+
2521	   |17   |ERR_MANIFEST_PROCESSING_FAILED      | Manifest     |This     |
2522	   |     |                                    | processing   |document |
2523	   |     |                                    | failure      |         |
2524	   +-----+------------------------------------+--------------+---------+
2525	   |18-22|(Reserved for future use)           |              |         |
2526	   +-----+------------------------------------+--------------+---------+
2527	   |23   |(Reserved)                          | Reserved for |         |
2528	   |     |                                    | future use   |         |
2529	   +-----+------------------------------------+--------------+---------+

2531	                                  Table 5

2533	   Note: Error codes are constrained to the range 0-23 to permit
2534	   encoding as single-byte CBOR unsigned integers.

2536	   Registration procedures are as follows:

2538	   *  1-10, 17: Standards Action

2540	   *  11-16, 18-23: Reserved for future use by Specification Required

2542	13.5.  TEEP CBOR Label Registry

2544	   IANA is requested to create a registry titled "TEEP CBOR Labels"
2545	   within the TEEP registry.  The registry has the following format:
2546	   Label values are not required to be contiguous; gaps are reserved for
2547	   future use.

2549	    +=======+=================+===========================+===========+
2550	    | Label | Name            | Type                      | Reference |
2551	    +=======+=================+===========================+===========+
2552	    | 0     | (Reserved)      |                           |           |
2553	    +-------+-----------------+---------------------------+-----------+
2554	    | 1     | supported-teep- | array                     | This      |
2555	    |       | cipher-suites   |                           | document  |
2556	    +-------+-----------------+---------------------------+-----------+
2557	    | 2     | challenge       | bstr                      | This      |
2558	    |       |                 |                           | document  |
2559	    +-------+-----------------+---------------------------+-----------+
2560	    | 3     | versions        | array                     | This      |
2561	    |       |                 |                           | document  |
2562	    +-------+-----------------+---------------------------+-----------+
2563	    | 4     | supported-suit- | array                     | This      |
2564	    |       | cose-profiles   |                           | document  |
2565	    +-------+-----------------+---------------------------+-----------+
2566	    | 5     | (Reserved)      |                           |           |
2567	    +-------+-----------------+---------------------------+-----------+
2568	    | 6     | selected-       | uint                      | This      |
2569	    |       | version         |                           | document  |
2570	    +-------+-----------------+---------------------------+-----------+
2571	    | 7     | attestation-    | bstr                      | This      |
2572	    |       | payload         |                           | document  |
2573	    +-------+-----------------+---------------------------+-----------+
2574	    | 8     | tc-list         | array                     | This      |
2575	    |       |                 |                           | document  |
2576	    +-------+-----------------+---------------------------+-----------+
2577	    | 9     | ext-list        | array                     | This      |
2578	    |       |                 |                           | document  |
2579	    +-------+-----------------+---------------------------+-----------+
2580	    | 10    | manifest-list   | array                     | This      |
2581	    |       |                 |                           | document  |
2582	    +-------+-----------------+---------------------------+-----------+
2583	    | 11    | msg             | text                      | This      |
2584	    |       |                 |                           | document  |
2585	    +-------+-----------------+---------------------------+-----------+
2586	    | 12    | err-msg         | text                      | This      |
2587	    |       |                 |                           | document  |
2588	    +-------+-----------------+---------------------------+-----------+
2589	    | 13    | attestation-    | text                      | This      |
2590	    |       | payload-format  |                           | document  |
2591	    +-------+-----------------+---------------------------+-----------+
2592	    | 14    | requested-tc-   | array                     | This      |
2593	    |       | list            |                           | document  |
2594	    +-------+-----------------+---------------------------+-----------+
2595	    | 15    | unneeded-       | array                     | This      |
2596	    |       | manifest-list   |                           | document  |
2597	    +-------+-----------------+---------------------------+-----------+
2598	    | 16    | component-id    | SUIT_Component_Identifier | This      |
2599	    |       |                 |                           | document  |
2600	    +-------+-----------------+---------------------------+-----------+
2601	    | 17    | tc-manifest-    | uint                      | This      |
2602	    |       | sequence-number |                           | document  |
2603	    +-------+-----------------+---------------------------+-----------+
2604	    | 18    | have-binary     | bool                      | This      |
2605	    |       |                 |                           | document  |
2606	    +-------+-----------------+---------------------------+-----------+
2607	    | 19    | suit-reports    | array                     | This      |
2608	    |       |                 |                           | document  |
2609	    +-------+-----------------+---------------------------+-----------+
2610	    | 20    | token           | bstr                      | This      |
2611	    |       |                 |                           | document  |
2612	    +-------+-----------------+---------------------------+-----------+
2613	    | 21    | supported-      | array                     | This      |
2614	    |       | freshness-      |                           | document  |
2615	    |       | mechanisms      |                           |           |
2616	    +-------+-----------------+---------------------------+-----------+
2617	    | 22    | (Reserved)      |                           |           |
2618	    +-------+-----------------+---------------------------+-----------+
2619	    | 23    | err-code        | uint                      | This      |
2620	    |       |                 |                           | document  |
2621	    +-------+-----------------+---------------------------+-----------+
2622	    | 2-255 | (Reserved for   |                           |           |
2623	    |       | future use)     |                           |           |
2624	    +-------+-----------------+---------------------------+-----------+
2625	    | 256-  | (Reserved for   |                           |           |
2626	    |       | future use)     |                           |           |
2627	    +-------+-----------------+---------------------------+-----------+
2628	                                  Table 6

2630	   Note: Labels are not constrained to a specific range.

2632	   Registration procedures are as follows:

2634	   *  0-255:: Standards Action

2636	   *  256 and above: Specification Required

2638	13.6.  TEEP Cipher Suite Registry

2640	   IANA is requested to create a registry titled "TEEP Cipher Suites"
2641	   within the TEEP registry.  The registry has the following format:

2643	        +=======+=================================+===============+
2644	        | Value | Name                            | Reference     |
2645	        +=======+=================================+===============+
2646	        | 0     | teep-cipher-suite-sign1-ed25519 | This document |
2647	        +-------+---------------------------------+---------------+
2648	        | 1     | teep-cipher-suite-sign1-esp256  | This document |
2649	        +-------+---------------------------------+---------------+
2650	        | 2-255 | (Reserved for future use)       |               |
2651	        +-------+---------------------------------+---------------+

2653	                                  Table 7

2655	   Registration procedures are as follows:

2657	   *  0-23: Standards Action

2659	   *  24-255: Specification Required

2661	   Any new cipher suites MUST provide authentication, integrity, and
2662	   SHOULD provide confidentiality protection.

2664	13.7.  TEEP Freshness Mechanism Registry

2666	   IANA is requested to create a registry titled "TEEP Freshness
2667	   Mechanisms" within the TEEP registry.  The registry has the following
2668	   format:

2670	           +=======+===========================+===============+
2671	           | Value | Name                      | Reference     |
2672	           +=======+===========================+===============+
2673	           | 0     | FRESHNESS_NONCE           | This document |
2674	           +-------+---------------------------+---------------+
2675	           | 1     | FRESHNESS_TIMESTAMP       | This document |
2676	           +-------+---------------------------+---------------+
2677	           | 2-255 | (Reserved for future use) |               |
2678	           +-------+---------------------------+---------------+

2680	                                  Table 8

2682	   Registration procedures are as follows:

2684	   *  0-23: Standards Action

2686	   *  24-255: Specification Required

2688	14.  References

2690	14.1.  Normative References

2692	   [COSE.Algorithm]
2693	              IANA, "COSE Algorithms", n.d.,
2694	              <https://www.iana.org/assignments/cose/
2695	              cose.xhtml#algorithms>.

2697	   [I-D.ietf-suit-manifest]
2698	              Moran, B., Tschofenig, H., Birkholz, H., Zandberg, K., and
2699	              O. Rønningstad, "A Concise Binary Object Representation
2700	              (CBOR)-based Serialization Format for the Software Updates
2701	              for Internet of Things (SUIT) Manifest", Work in Progress,
2702	              Internet-Draft, draft-ietf-suit-manifest-34, 28 May 2025,
2703	              <https://datatracker.ietf.org/doc/html/draft-ietf-suit-
2704	              manifest-34>.

2706	   [I-D.ietf-suit-mti]
2707	              Moran, B., Rønningstad, O., and A. Tsukamoto,
2708	              "Cryptographic Algorithms for Internet of Things (IoT)
2709	              Devices", Work in Progress, Internet-Draft, draft-ietf-
2710	              suit-mti-23, 22 July 2025,
2711	              <https://datatracker.ietf.org/doc/html/draft-ietf-suit-
2712	              mti-23>.

2714	   [I-D.ietf-suit-report]
2715	              Moran, B. and H. Birkholz, "Secure Reporting of SUIT
2716	              Update Status", Work in Progress, Internet-Draft, draft-
2717	              ietf-suit-report-18, 9 December 2025,
2718	              <https://datatracker.ietf.org/doc/html/draft-ietf-suit-
2719	              report-18>.

2721	   [I-D.ietf-suit-trust-domains]
2722	              Moran, B. and K. Takayama, "Software Update for the
2723	              Internet of Things (SUIT) Manifest Extensions for Multiple
2724	              Trust Domain", Work in Progress, Internet-Draft, draft-
2725	              ietf-suit-trust-domains-12, 22 July 2025,
2726	              <https://datatracker.ietf.org/doc/html/draft-ietf-suit-
2727	              trust-domains-12>.

2729	   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
2730	              Requirement Levels", BCP 14, RFC 2119,
2731	              DOI 10.17487/RFC2119, March 1997,
2732	              <https://www.rfc-editor.org/rfc/rfc2119>.

2734	   [RFC3629]  Yergeau, F., "UTF-8, a transformation format of ISO
2735	              10646", STD 63, RFC 3629, DOI 10.17487/RFC3629, November
2736	              2003, <https://www.rfc-editor.org/rfc/rfc3629>.

2738	   [RFC5198]  Klensin, J. and M. Padlipsky, "Unicode Format for Network
2739	              Interchange", RFC 5198, DOI 10.17487/RFC5198, March 2008,
2740	              <https://www.rfc-editor.org/rfc/rfc5198>.

2742	   [RFC5646]  Phillips, A., Ed. and M. Davis, Ed., "Tags for Identifying
2743	              Languages", BCP 47, RFC 5646, DOI 10.17487/RFC5646,
2744	              September 2009, <https://www.rfc-editor.org/rfc/rfc5646>.

2746	   [RFC8174]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in RFC
2747	              2119 Key Words", BCP 14, RFC 8174, DOI 10.17487/RFC8174,
2748	              May 2017, <https://www.rfc-editor.org/rfc/rfc8174>.

2750	   [RFC8610]  Birkholz, H., Vigano, C., and C. Bormann, "Concise Data
2751	              Definition Language (CDDL): A Notational Convention to
2752	              Express Concise Binary Object Representation (CBOR) and
2753	              JSON Data Structures", RFC 8610, DOI 10.17487/RFC8610,
2754	              June 2019, <https://www.rfc-editor.org/rfc/rfc8610>.

2756	   [RFC8747]  Jones, M., Seitz, L., Selander, G., Erdtman, S., and H.
2757	              Tschofenig, "Proof-of-Possession Key Semantics for CBOR
2758	              Web Tokens (CWTs)", RFC 8747, DOI 10.17487/RFC8747, March
2759	              2020, <https://www.rfc-editor.org/rfc/rfc8747>.

2761	   [RFC8949]  Bormann, C. and P. Hoffman, "Concise Binary Object
2762	              Representation (CBOR)", STD 94, RFC 8949,
2763	              DOI 10.17487/RFC8949, December 2020,
2764	              <https://www.rfc-editor.org/rfc/rfc8949>.

2766	   [RFC9052]  Schaad, J., "CBOR Object Signing and Encryption (COSE):
2767	              Structures and Process", STD 96, RFC 9052,
2768	              DOI 10.17487/RFC9052, August 2022,
2769	              <https://www.rfc-editor.org/rfc/rfc9052>.

2771	   [RFC9397]  Pei, M., Tschofenig, H., Thaler, D., and D. Wheeler,
2772	              "Trusted Execution Environment Provisioning (TEEP)
2773	              Architecture", RFC 9397, DOI 10.17487/RFC9397, July 2023,
2774	              <https://www.rfc-editor.org/rfc/rfc9397>.

2776	   [RFC9679]  Isobe, K., Tschofenig, H., and O. Steele, "CBOR Object
2777	              Signing and Encryption (COSE) Key Thumbprint", RFC 9679,
2778	              DOI 10.17487/RFC9679, December 2024,
2779	              <https://www.rfc-editor.org/rfc/rfc9679>.

2781	   [RFC9711]  Lundblade, L., Mandyam, G., O'Donoghue, J., and C.
2782	              Wallace, "The Entity Attestation Token (EAT)", RFC 9711,
2783	              DOI 10.17487/RFC9711, April 2025,
2784	              <https://www.rfc-editor.org/rfc/rfc9711>.

2786	14.2.  Informative References

2788	   [I-D.ietf-opsawg-rfc5706bis]
2789	              Claise, B., Clarke, J., Farrel, A., Barguil, S.,
2790	              Pignataro, C., and R. Chen, "Guidelines for Considering
2791	              Operations and Management in IETF Specifications", Work in
2792	              Progress, Internet-Draft, draft-ietf-opsawg-rfc5706bis-01,
2793	              17 December 2025, <https://datatracker.ietf.org/doc/html/
2794	              draft-ietf-opsawg-rfc5706bis-01>.

2796	   [I-D.ietf-rats-ar4si]
2797	              Voit, E., Birkholz, H., Hardjono, T., Fossati, T., and V.
2798	              Scarlata, "Attestation Results for Secure Interactions",
2799	              Work in Progress, Internet-Draft, draft-ietf-rats-ar4si-
2800	              09, 15 August 2025,
2801	              <https://datatracker.ietf.org/doc/html/draft-ietf-rats-
2802	              ar4si-09>.

2804	   [I-D.ietf-rats-concise-ta-stores]
2805	              Wallace, C., Housley, R., Fossati, T., and Y. Deshpande,
2806	              "Concise TA Stores (CoTS)", Work in Progress, Internet-
2807	              Draft, draft-ietf-rats-concise-ta-stores-02, 5 December
2808	              2023, <https://datatracker.ietf.org/doc/html/draft-ietf-
2809	              rats-concise-ta-stores-02>.

2811	   [I-D.ietf-rats-reference-interaction-models]
2812	              Birkholz, H., Eckel, M., Pan, W., and E. Voit, "Reference
2813	              Interaction Models for Remote Attestation Procedures",
2814	              Work in Progress, Internet-Draft, draft-ietf-rats-
2815	              reference-interaction-models-15, 5 November 2025,
2816	              <https://datatracker.ietf.org/doc/html/draft-ietf-rats-
2817	              reference-interaction-models-15>.

2819	   [I-D.ietf-suit-firmware-encryption]
2820	              Tschofenig, H., Housley, R., Moran, B., Brown, D., and K.
2821	              Takayama, "Encrypted Payloads in SUIT Manifests", Work in
2822	              Progress, Internet-Draft, draft-ietf-suit-firmware-
2823	              encryption-26, 8 December 2025,
2824	              <https://datatracker.ietf.org/doc/html/draft-ietf-suit-
2825	              firmware-encryption-26>.

2827	   [I-D.ietf-teep-otrp-over-http]
2828	              Thaler, D., "HTTP Transport for Trusted Execution
2829	              Environment Provisioning: Agent Initiated Communication",
2830	              Work in Progress, Internet-Draft, draft-ietf-teep-otrp-
2831	              over-http-15, 27 March 2023,
2832	              <https://datatracker.ietf.org/doc/html/draft-ietf-teep-
2833	              otrp-over-http-15>.

2835	   [RFC5934]  Housley, R., Ashmore, S., and C. Wallace, "Trust Anchor
2836	              Management Protocol (TAMP)", RFC 5934,
2837	              DOI 10.17487/RFC5934, August 2010,
2838	              <https://www.rfc-editor.org/rfc/rfc5934>.

2840	   [RFC8915]  Franke, D., Sibold, D., Teichel, K., Dansarie, M., and R.
2841	              Sundblad, "Network Time Security for the Network Time
2842	              Protocol", RFC 8915, DOI 10.17487/RFC8915, September 2020,
2843	              <https://www.rfc-editor.org/rfc/rfc8915>.

2845	   [RFC9124]  Moran, B., Tschofenig, H., and H. Birkholz, "A Manifest
2846	              Information Model for Firmware Updates in Internet of
2847	              Things (IoT) Devices", RFC 9124, DOI 10.17487/RFC9124,
2848	              January 2022, <https://www.rfc-editor.org/rfc/rfc9124>.

2850	   [RFC9334]  Birkholz, H., Thaler, D., Richardson, M., Smith, N., and
2851	              W. Pan, "Remote ATtestation procedureS (RATS)
2852	              Architecture", RFC 9334, DOI 10.17487/RFC9334, January
2853	              2023, <https://www.rfc-editor.org/rfc/rfc9334>.

2855	   [RFC9782]  Lundblade, L., Birkholz, H., and T. Fossati, "Entity
2856	              Attestation Token (EAT) Media Types", RFC 9782,
2857	              DOI 10.17487/RFC9782, May 2025,
2858	              <https://www.rfc-editor.org/rfc/rfc9782>.

2860	A.  Contributors

2862	   We would like to thank Brian Witten (Symantec), Tyler Kim (Solacia),
2863	   Nick Cook (Arm), and Minho Yoo (IoTrust) for their contributions to
2864	   the Open Trust Protocol (OTrP), which influenced the design of this
2865	   specification.

2867	B.  Acknowledgements

2869	   We would like to thank Eve Schooler for the suggestion of the
2870	   protocol name.

2872	   We would like to thank Kohei Isobe (TRASIO/SECOM), Ken Takayama
2873	   (SECOM), Kuniyasu Suzaki (TRASIO/AIST), Tsukasa Oi (TRASIO), and
2874	   Yuichi Takita (SECOM) for their valuable implementation feedback.

2876	   We would also like to thank Carsten Bormann and Henk Birkholz for
2877	   their help with the CDDL.

2879	   Finally, we would like to thank the following IESG members for their
2880	   review feedback: Sean Turner, Paul Kyzivat, Scott Hollenbeck, Luigi
2881	   Iannone, Paul Wouters, and Yoshifumi Nishida

2883	C.  Complete CDDL

2885	   Valid TEEP messages adhere to the following CDDL data definitions,
2886	   except that SUIT_Envelope and SUIT_Component_Identifier are specified
2887	   in [I-D.ietf-suit-manifest].

2889	   This section is informative and merely summarizes the normative CDDL
2890	   snippets in the body of this document.

2892	   teep-message = $teep-message-type .within teep-message-framework

2894	   teep-message-framework = [
2895	     type: $teep-type / $teep-type-extension,
2896	     options: { * teep-option },
2897	     * any; further elements, e.g., for data-item-requested

2899	   ]

2901	   teep-option = (uint => any)

2903	   ; messages defined below:
2904	   $teep-message-type /= query-request
2905	   $teep-message-type /= query-response
2906	   $teep-message-type /= update
2907	   $teep-message-type /= success
2908	   $teep-message-type /= error

2910	   ; message type numbers, in one byte which could take a
2911	   ; number from 0 to 23
2912	   $teep-type /= (0..23)
2913	   TEEP-TYPE-query-request = 1
2914	   TEEP-TYPE-query-response = 2
2915	   TEEP-TYPE-update = 3
2916	   TEEP-TYPE-success = 5
2917	   TEEP-TYPE-error = 6
2918	   ; value 4 is reserved for future use; registries are
2919	   ; intentionally sparse and values are not required to be contiguous.

2921	   query-request = [
2922	     type: TEEP-TYPE-query-request,
2923	     options: {
2924	       ? token => bstr .size (8..64),
2925	       ? supported-freshness-mechanisms => [ + $freshness-mechanism ],
2926	       ? challenge => bstr .size (8..512),
2927	       ? versions => [ + version ],
2928	       ? attestation-payload-format => text,
2929	       ? attestation-payload => bstr,
2930	       ? suit-reports => [ + bstr .cbor
2931	                (SUIT_Report_Protected / SUIT_Report_Unprotected) ],
2932	       * $$query-request-extensions,
2933	       * $$teep-option-extensions
2934	     },
2935	     supported-teep-cipher-suites: [ + $teep-cipher-suite ],
2936	     supported-suit-cose-profiles: [ + $suit-cose-profile ],
2937	     data-item-requested: uint .bits data-item-requested
2938	   ]

2940	   version = uint .size 4
2941	   ext-info = uint .size 4

2943	   ; data items as bitmaps
2944	   data-item-requested = &(
2945	     attestation: 0,
2946	     trusted-components: 1,
2947	     extensions: 2,
2948	     suit-reports: 3,
2949	   )

2951	   ; teep-cipher-suites
2952	   $teep-cipher-suite /= teep-cipher-suite-sign1-ed25519
2953	   $teep-cipher-suite /= teep-cipher-suite-sign1-esp256

2955	   ;The following two cipher suites have only a single operation each.
2956	   ;Other cipher suites may be defined to have multiple operations.
2957	   ;It is mandatory for TAM to support them, and optional
2958	   ;to support any additional ones that use COSE_Sign_Tagged, or other
2959	   ;signing, encryption, or MAC algorithms.

2961	   teep-operation-sign1-ed25519 = [ cose-sign1, cose-alg-ed25519 ]
2962	   teep-operation-sign1-esp256  = [ cose-sign1, cose-alg-esp256 ]

2964	   teep-cipher-suite-sign1-ed25519 = [ teep-operation-sign1-ed25519 ]
2965	   teep-cipher-suite-sign1-esp256  = [ teep-operation-sign1-esp256 ]

2967	   ;Mandatory for TAM and TEEP Agent to support the following COSE
2968	   ;operations, and optional to support additional ones such as
2969	   ;COSE_Sign_Tagged, COSE_Encrypt0_Tagged, etc.

2971	   cose-sign1 = 18      ; CoAP Content-Format value

2973	   ;Mandatory for TAM to support the following, and optional to
2974	   ;implement any additional algorithms from the IANA COSE Algorithms
2975	   ;registry.

2977	   cose-alg-esp256  = -9   ; ECDSA using P-256 curve and SHA-256
2978	   cose-alg-ed25519 = -19  ; EdDSA using Ed25519 curve

2980	   ; suit-cose-profile
2981	   $suit-cose-profile /= suit-sha256-esp256-ecdh-a128ctr
2982	   $suit-cose-profile /= suit-sha256-ed25519-ecdh-a128ctr
2983	   $suit-cose-profile /= suit-sha256-esp256-ecdh-a128gcm
2984	   $suit-cose-profile /= suit-sha256-ed25519-ecdh-chacha-poly

2986	   ; freshness-mechanisms
2987	   FRESHNESS_NONCE = 0
2988	   FRESHNESS_TIMESTAMP = 1

2990	   $freshness-mechanism /= FRESHNESS_NONCE
2991	   $freshness-mechanism /= FRESHNESS_TIMESTAMP

2993	   query-response = [
2994	     type: TEEP-TYPE-query-response,
2995	     options: {
2996	       ? token => bstr .size (8..64),
2997	       ? selected-version => version,
2998	       ? attestation-payload-format => text,
2999	       ? attestation-payload => bstr,
3000	       ? suit-reports => [ + bstr .cbor
3001	                (SUIT_Report_Protected / SUIT_Report_Unprotected) ],
3002	       ? tc-list => [ + system-property-claims ],
3003	       ? requested-tc-list => [ + requested-tc-info ],
3004	       ? unneeded-manifest-list => [ + SUIT_Component_Identifier ],
3005	       ? ext-list => [ + ext-info ],
3006	       * $$query-response-extensions,
3007	       * $$teep-option-extensions
3008	     }
3009	   ]

3011	   requested-tc-info = {
3012	     component-id => SUIT_Component_Identifier,
3013	     ? tc-manifest-sequence-number => uint,
3014	     ? have-binary => bool
3015	   }

3017	   update = [
3018	     type: TEEP-TYPE-update,
3019	     options: {
3020	       ? token => bstr .size (8..64),
3021	       ? unneeded-manifest-list => [ + SUIT_Component_Identifier ],
3022	       ? manifest-list => [ + bstr .cbor SUIT_Envelope ],
3023	       ? attestation-payload-format => text,
3024	       ? attestation-payload => bstr,
3025	       ? err-code => err-code-values,
3026	       ? err-msg => text .size (1..128),
3027	       ? err-lang => text .size (1..35),
3028	       * $$update-extensions,
3029	       * $$teep-option-extensions
3030	     }
3031	   ]

3033	   success = [
3034	     type: TEEP-TYPE-success,
3035	     options: {
3036	       ? token => bstr .size (8..64),
3037	       ? msg => text .size (1..128),
3038	       ? suit-reports => [ + bstr .cbor
3039	                (SUIT_Report_Protected / SUIT_Report_Unprotected) ],
3040	       * $$success-extensions,
3041	       * $$teep-option-extensions
3042	     }

3044	   ]

3046	   error = [
3047	     type: TEEP-TYPE-error,
3048	     options: {
3049	        ? token => bstr .size (8..64),
3050	        ? err-msg => text .size (1..128),
3051	        ? err-lang => text .size (1..35),
3052	        ? supported-teep-cipher-suites => [ + $teep-cipher-suite ],
3053	        ? supported-freshness-mechanisms => [ + $freshness-mechanism ],
3054	        ? supported-suit-cose-profiles => [ + $suit-cose-profile ],
3055	        ? challenge => bstr .size (8..512),
3056	        ? versions => [ + version ],
3057	        ? suit-reports => [ + bstr .cbor
3058	                (SUIT_Report_Protected / SUIT_Report_Unprotected) ],
3059	        * $$error-extensions,
3060	        * $$teep-option-extensions
3061	     },
3062	     err-code: err-code-values
3063	   ]

3065	   ; The err-code parameter, uint (1..23)
3066	   ERR_PERMANENT_ERROR = 1
3067	   ERR_UNSUPPORTED_EXTENSION = 2
3068	   ERR_UNSUPPORTED_FRESHNESS_MECHANISMS = 3
3069	   ERR_UNSUPPORTED_MSG_VERSION = 4
3070	   ERR_UNSUPPORTED_CIPHER_SUITES = 5
3071	   ERR_BAD_CERTIFICATE = 6
3072	   ERR_ATTESTATION_REQUIRED = 7
3073	   ERR_UNSUPPORTED_SUIT_REPORT = 8
3074	   ERR_CERTIFICATE_EXPIRED = 9
3075	   ERR_TEMPORARY_ERROR = 10
3076	   ERR_MANIFEST_PROCESSING_FAILED = 17

3078	   err-code-values = ERR_PERMANENT_ERROR
3079	            / ERR_UNSUPPORTED_EXTENSION
3080	            / ERR_UNSUPPORTED_FRESHNESS_MECHANISMS
3081	            / ERR_UNSUPPORTED_MSG_VERSION
3082	            / ERR_UNSUPPORTED_CIPHER_SUITES
3083	            / ERR_BAD_CERTIFICATE
3084	            / ERR_ATTESTATION_REQUIRED
3085	            / ERR_UNSUPPORTED_SUIT_REPORT
3086	            / ERR_CERTIFICATE_EXPIRED
3087	            / ERR_TEMPORARY_ERROR
3088	            / ERR_MANIFEST_PROCESSING_FAILED

3090	   ; labels of mapkey for teep message parameters, uint (0..23)
3091	   supported-teep-cipher-suites = 1
3092	   challenge = 2
3093	   versions = 3
3094	   supported-suit-cose-profiles = 4
3095	   selected-version = 6
3096	   attestation-payload = 7
3097	   tc-list = 8
3098	   ext-list = 9
3099	   manifest-list = 10
3100	   msg = 11
3101	   err-msg = 12
3102	   attestation-payload-format = 13
3103	   requested-tc-list = 14
3104	   unneeded-manifest-list = 15
3105	   component-id = 16
3106	   tc-manifest-sequence-number = 17
3107	   have-binary = 18
3108	   suit-reports = 19
3109	   token = 20
3110	   supported-freshness-mechanisms = 21
3111	   err-lang = 22
3112	   err-code = 23

3114	D.  Examples of Diagnostic Notation and Binary Representation

3116	   This section includes some examples with the following assumptions:

3118	   *  The device will have two TCs with the following SUIT Component
3119	      Identifiers:

3121	      -  [ 0x000102030405060708090a0b0c0d0e0f ]

3123	      -  [ 0x100102030405060708090a0b0c0d0e0f ]

3125	   *  SUIT manifest-list is set empty only for example purposes (see
3126	      Appendix E for actual manifest examples)

3128	D.1.  QueryRequest Message

3130	D.1.1.  CBOR Diagnostic Notation
3131	   / query-request = /
3132	   [
3133	     / type: / 1 / TEEP-TYPE-query-request /,
3134	     / options: /
3135	     {
3136	       / token / 20 : h'A0A1A2A3A4A5A6A7A8A9AAABACADAEAF',
3137	       / versions / 3 : [ 0 ]  / 0 is current TEEP Protocol /
3138	     },
3139	     / supported-teep-cipher-suites: / [
3140	       [ [ 18, -9 ] ] / Sign1 using ESP256 /,
3141	       [ [ 18, -19 ] ] / Sign1 using Ed25519 /
3142	     ],
3143	     / supported-suit-cose-profiles: / [
3144	       [-16, -9, -29, -65534] / suit-sha256-esp256-ecdh-a128ctr /,
3145	       [-16, -19, -29, -65534] / suit-sha256-ed25519-ecdh-a128ctr /,
3146	       [-16, -9, -29, 1]      / suit-sha256-esp256-ecdh-a128gcm /,
3147	       [-16, -19, -29, 24]     / suit-sha256-ed25519-ecdh-chacha-poly /
3148	     ],
3149	     / data-item-requested: / 3 / attestation | trusted-components /
3150	   ]

3152	D.1.2.  CBOR Binary Representation
3153	   =============== NOTE: '\' line wrapping per RFC 8792 ================

3155	   85                  # array(5)
3156	      01               # unsigned(1) / TEEP-TYPE-query-request /
3157	      A2               # map(2)
3158	         14            # unsigned(20) / token: /
3159	         50            # bytes(16)
3160	            A0A1A2A3A4A5A6A7A8A9AAABACADAEAF
3161	         03            # unsigned(3) / versions: /
3162	         81            # array(1) / [ 0 ] /
3163	            00         # unsigned(0)
3164	      82               # array(2) / supported-teep-cipher-suites /
3165	         81            # array(1)
3166	            82         # array(2)
3167	               12      # unsigned(18) / cose-sign1 /
3168	               28      # negative(8) / -9 = cose-alg-esp256 /
3169	         81            # array(1)
3170	            82         # array(2)
3171	               12      # unsigned(18) / cose-sign1 /
3172	               32      # negative(18) / -19 = cose-alg-ed25519 /
3173	      84               # array(4) / supported-suit-cose-profiles /
3174	         84            # array(4) / suit-sha256-esp256-ecdh-a128ctr /,
3175	            2f         # negative(15) / -16 = SHA-256 /
3176	            28         # negative(8) / -9 = ESP256 /
3177	            38 1C      # negative(28) / -29 = ECDH-ES + A128KW /
3178	            39 fffd    # negative(65533) / -65534 = A128CTR /
3179	         84            # array(4) / suit-sha256-ed25519-ecdh-a128ctr /
3180	            2f         # negative(15) / -16 = SHA-256 /
3181	            32         # negative(18) / -19 = Ed25519 /
3182	            38 1C      # negative(28) / -29 = ECDH-ES + A128KW /
3183	            39 fffd    # negative(65533) / -65534 = A128CTR /
3184	         84            # array(4) / suit-sha256-esp256-ecdh-a128gcm /
3185	            2f         # negative(15) / -16 = SHA-256 /
3186	            28         # negative(6) / -9 = ESP256 /
3187	            38 1C      # negative(28) / -29 = ECDH-ES + A128KW /
3188	            01         # unsigned(1) / A128GCM /
3189	         84            # array(4) / suit-sha256-ed25519-ecdh-chacha-\
3190	                                                                  poly /
3191	            2f         # negative(15) / -16 = SHA-256 /
3192	            32         # negative(18) / Ed25519 /
3193	            38 1C      # negative(28) / -29 = ECDH-ES + A128KW /
3194	            18 18      # unsigned(24) / 24 = ChaCha20/Poly1305 /
3195	      03               # unsigned(3) / attestation | trusted-\
3196	                                                            components /

3198	D.2.  Entity Attestation Token

3200	   This is shown below in CBOR diagnostic form.  Only the payload signed
3201	   by COSE is shown.

3203	D.2.1.  CBOR Diagnostic Notation

3205	   / eat-claim-set = /
3206	   {
3207	       / cnf /          8: {
3208	                            / kid /
3209	                            3 : h'ba7816bf8f01cfea414140de5dae2223'
3210	                                h'b00361a396177a9cb410ff61f20015ad'
3211	                           },
3212	       / eat_nonce /   10: h'948f8860d13a463e8e',
3213	       / ueid /       256: h'0198f50a4ff6c05861c8860d13a638ea',
3214	       / oemid /      258: h'894823', / IEEE OUI format OEM ID /
3215	       / hwmodel /    259: h'549dcecc8b987c737b44e40f7c635ce8'
3216	                             / Hash of chip model name /,
3217	       / hwversion /  260: ["1.3.4", 1], / Multipart numeric  /
3218	       / manifests /  273: [
3219	                             [ 60,
3220	                                / application/cbor, TO BE REPLACED /
3221	                                / with the format value for a /
3222	                               / SUIT_Reference once one is allocated /
3223	                               {
3224	                                 / SUIT_Reference /
3225	                                 / suit-report-manifest-uri /
3226	                                 1: "https://example.com/manifest.cbor",
3227	                                 / suit-report-manifest-digest /
3228	                                 0:[
3229	                                   / algorithm-id /
3230	                                   -16 / "sha256" /,
3231	                                   / digest-bytes /
3232	                                   h'a7fd6593eac32eb4be578278e6540c5c'
3233	                                   h'09cfd7d4d234973054833b2b93030609'
3234	                                   ]
3235	                               }
3236	                             ]
3237	                           ]
3238	   }

3240	D.3.  QueryResponse Message

3242	D.3.1.  CBOR Diagnostic Notation
3243	   =============== NOTE: '\' line wrapping per RFC 8792 ================

3245	   / query-response = /
3246	   [
3247	     / type: / 2 / TEEP-TYPE-query-response /,
3248	     / options: /
3249	     {
3250	       / token / 20 : h'A0A1A2A3A4A5A6A7A8A9AAABACADAEAF',
3251	       / selected-version / 6 : 0,
3252	       / attestation-payload / 7 : h'' / empty only for example \
3253	                                                              purpose /,
3254	       / tc-list / 8 : [
3255	         {
3256	           / system-component-id / 0 : [ h'\
3257	                                      0102030405060708090A0B0C0D0E0F' ],
3258	           / suit-parameter-image-digest / 3: << [
3259	             / suit-digest-algorithm-id / -16 / SHA256 /,
3260	             / suit-digest-bytes / h'\
3261	       A7FD6593EAC32EB4BE578278E6540C5C09CFD7D4D234973054833B2B93030609'
3262	               / SHA256 digest of tc binary /
3263	           ] >>
3264	         }
3265	       ]
3266	     }
3267	   ]

3269	D.3.2.  CBOR Binary Representation
3270	   =============== NOTE: '\' line wrapping per RFC 8792 ================

3272	   82                  # array(2)
3273	      02               # unsigned(2) / TEEP-TYPE-query-response /
3274	      A4               # map(4)
3275	         14            # unsigned(20) / token: /
3276	         50            # bytes(16)
3277	            A0A1A2A3A4A5A6A7A8A9AAABACADAEAF
3278	         06            # unsigned(6) / selected-version: /
3279	         00            # unsigned(0)
3280	         07            # unsigned(7) / attestation-payload: /
3281	         40            # bytes(0)
3282	                       # ""
3283	         08            # unsigned(8) / tc-list: /
3284	         81            # array(1)
3285	            A2         # map(2)
3286	               00      # unsigned(0) / system-component-id: /
3287	               81      # array(1)
3288	                  4F   # bytes(15)
3289	                     0102030405060708090A0B0C0D0E0F
3290	               03      # unsigned(3) / suit-parameter-image-digest: /
3291	               58 24   # bytes(36)
3292	                  \
3293	   822F5820A7FD6593EAC32EB4BE578278E6540C5C09CFD7D4D234973054833B2B9303\
3294	                                                                    0609

3296	D.4.  Update Message

3298	D.4.1.  CBOR Diagnostic Notation

3300	   =============== NOTE: '\' line wrapping per RFC 8792 ================

3302	   / update = /
3303	   [
3304	     / type: / 3 / TEEP-TYPE-update /,
3305	     / options: /
3306	     {
3307	       / token / 20 : h'A0A1A2A3A4A5A6A7A8A9AAABACADAEAF',
3308	       / manifest-list / 10 : [
3309	         <<
3310	           / SUIT_Envelope / {
3311	             / suit-authentication-wrapper / 2: << [
3312	               << [
3313	                 / suit-digest-algorithm-id: / -16 / suit-cose-alg-\
3314	                                                               sha256 /,
3315	                 / suit-digest-bytes: / h'\
3316	       DB601ADE73092B58532CA03FBB663DE49532435336F1558B49BB622726A2FEDD'
3317	               ] >>,
3318	               << / COSE_Sign1_Tagged / 18( [
3319	                 / protected: / << {
3320	                   / algorithm-id / 1: -7 / ES256 /
3321	                 } >>,
3322	                 / unprotected: / {},
3323	                 / payload: / null,
3324	                 / signature: / h'\
3325	   5B2D535A2B6D5E3C585C1074F414DA9E10BD285C99A33916DADE3ED38812504817AC\
3326	           48B62B8E984EC622785BD1C411888BE531B1B594507816B201F6F28579A4'
3327	               ] ) >>
3328	             ] >>,
3329	             / suit-manifest / 3: << {
3330	               / suit-manifest-version / 1: 1,
3331	               / suit-manifest-sequence-number / 2: 3,
3332	               / suit-common / 3: << {
3333	                 / suit-components / 2: [
3334	                   [
3335	                     h'544545502D446576696365',           / "TEEP-\
3336	                                                               Device" /
3337	                     h'5365637572654653',                 / "SecureFS" /
3338	                     h'8D82573A926D4754935332DC29997F74', / tc-uuid /
3339	                     h'7461'                              / "ta" /
3340	                   ]
3341	                 ],
3342	                 / suit-common-sequence / 4: << [
3343	                   / suit-directive-override-parameters / 20, {
3344	                     / suit-parameter-vendor-identifier / 1: h'\
3345	                                      C0DDD5F15243566087DB4F5B0AA26C2F',
3346	                     / suit-parameter-class-identifier / 2: h'\
3347	                                      DB42F7093D8C55BAA8C5265FC5820F4E',
3348	                     / suit-parameter-image-digest / 3: << [
3349	                       / suit-digest-algorithm-id: / -16 / suit-cose-\
3350	                                                           alg-sha256 /,
3351	                       / suit-digest-bytes: / h'\
3352	       8CF71AC86AF31BE184EC7A05A411A8C3A14FD9B77A30D046397481469468ECE8'
3353	                     ] >>,
3354	                     / suit-parameter-image-size / 14: 20
3355	                   },
3356	                   / suit-condition-vendor-identifier / 1, 15,
3357	                   / suit-condition-class-identifier / 2, 15
3358	                 ] >>
3359	               } >>,
3360	               / suit-install / 9: << [
3361	                 / suit-directive-override-parameters / 20, {
3362	                   / suit-parameter-uri / 21: "https://example.org/\
3363	                                8d82573a-926d-4754-9353-32dc29997f74.ta"
3364	                 },
3365	                 / suit-directive-fetch / 21, 15,
3366	                 / suit-condition-image-match / 3, 15
3367	               ] >>
3368	             } >>
3369	           }
3370	         >>
3371	       ] / array of bstr wrapped SUIT_Envelope /
3372	     }
3373	   ]

3375	D.4.2.  CBOR Binary Representation

3377	   =============== NOTE: '\' line wrapping per RFC 8792 ================

3379	   82                  # array(2)
3380	      03               # unsigned(3) / TEEP-TYPE-update /
3381	      A2               # map(2)
3382	         14            # unsigned(20) / token: /
3383	         50            # bytes(16)
3384	            A0A1A2A3A4A5A6A7A8A9AAABACADAEAF
3385	         0A            # unsigned(10) / manifest-list: /
3386	         81            # array(1)
3387	            59 014E    # bytes(336)
3388	               A2025873825824822F5820DB601ADE73092B58532CA03FBB663DE495
3389	               \
3390	            32435336F1558B49BB622726A2FEDD584AD28443A10126A0F658405B2D53
3391	               \
3392	            5A2B6D5E3C585C1074F414DA9E10BD285C99A33916DADE3ED38812504817
3393	               \
3394	            AC48B62B8E984EC622785BD1C411888BE531B1B594507816B201F6F28579
3395	               \
3396	            A40358D4A401010203035884A20281844B544545502D4465766963654853
3397	               \
3398	            65637572654653508D82573A926D4754935332DC29997F74427461045854
3399	               \
3400	            8614A40150C0DDD5F15243566087DB4F5B0AA26C2F0250DB42F7093D8C55
3401	               \
3402	            BAA8C5265FC5820F4E035824822F58208CF71AC86AF31BE184EC7A05A411
3403	               \
3404	            A8C3A14FD9B77A30D046397481469468ECE80E14010F020F0958458614A1
3405	               \
3406	            15783B68747470733A2F2F6578616D706C652E6F72672F38643832353733
3407	               \
3408	            612D393236642D343735342D393335332D3332646332393939376637342E
3409	               7461150F030F

3411	D.5.  Success Message

3413	D.5.1.  CBOR Diagnostic Notation

3415	   / teep-success = /
3416	   [
3417	     / type: / 5 / TEEP-TYPE-teep-success /,
3418	     / options: /
3419	     {
3420	       / token / 20 : h'A0A1A2A3A4A5A6A7A8A9AAABACADAEAF'
3421	     }
3422	   ]

3424	D.5.2.  CBOR Binary Representation

3426	   82                  # array(2)
3427	      05               # unsigned(5) / TEEP-TYPE-teep-success /
3428	      A1               # map(1)
3429	         14            # unsigned(20) / token: /
3430	         50            # bytes(16)
3431	            A0A1A2A3A4A5A6A7A8A9AAABACADAEAF

3433	D.6.  Error Message

3435	D.6.1.  CBOR Diagnostic Notation

3437	   / teep-error = /
3438	   [
3439	     / type: / 6 / TEEP-TYPE-teep-error /,
3440	     / options: /
3441	     {
3442	       / token / 20 : h'A0A1A2A3A4A5A6A7A8A9AAABACADAEAF',
3443	       / err-msg / 12 : "disk-full"
3444	     },
3445	     / err-code: / 17 / ERR_MANIFEST_PROCESSING_FAILED /
3446	   ]

3448	D.6.2.  CBOR binary Representation
3449	   83                  # array(3)
3450	      06               # unsigned(6) / TEEP-TYPE-teep-error /
3451	      A2               # map(2)
3452	         14            # unsigned(20) / token: /
3453	         50            # bytes(16)
3454	            A0A1A2A3A4A5A6A7A8A9AAABACADAEAF
3455	         0C            # unsigned(12) / err-msg: /
3456	         69            # text(9)
3457	            6469736B2D66756C6C # "disk-full"
3458	      11               # unsigned(17) / ERR_MANIFEST_PROCESSING_FAILED /

3460	E.  Examples of SUIT Manifests

3462	   This section shows some examples of SUIT manifests described in
3463	   Section 4.4.

3465	   The examples are signed using the following ECDSA secp256r1 key with
3466	   SHA256 as the digest function.

3468	   COSE_Sign1 Cryptographic Key:

3470	   -----BEGIN PRIVATE KEY-----
3471	   MIGHAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBG0wawIBAQQgApZYjZCUGLM50VBC
3472	   CjYStX+09jGmnyJPrpDLTz/hiXOhRANCAASEloEarguqq9JhVxie7NomvqqL8Rtv
3473	   P+bitWWchdvArTsfKktsCYExwKNtrNHXi9OB3N+wnAUtszmR23M4tKiW
3474	   -----END PRIVATE KEY-----

3476	   The corresponding public key can be used to verify these examples:

3478	   -----BEGIN PUBLIC KEY-----
3479	   MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEhJaBGq4LqqvSYVcYnuzaJr6qi/Eb
3480	   bz/m4rVlnIXbwK07HypLbAmBMcCjbazR14vTgdzfsJwFLbM5kdtzOLSolg==
3481	   -----END PUBLIC KEY-----

3483	Example 1: SUIT Manifest pointing to URI of the Trusted Component Binary

3485	CBOR Diagnostic Notation of SUIT Manifest

3487	   =============== NOTE: '\' line wrapping per RFC 8792 ================

3489	   / SUIT_Envelope / {
3490	     / authentication-wrapper / 2: << [
3491	       << [
3492	         / digest-algorithm-id: / -16 / SHA256 /,
3493	         / digest-bytes: / h'\
3494	       B39B52B0B747EA79588C190F567BFC2C8437BA8A73F7EA983182E79F0148D59B'
3495	       ] >>,
3496	       << / COSE_Sign1_Tagged / 18([
3497	         / protected: / << {
3498	           / algorithm-id / 1: -9 / ESP256 /
3499	         } >>,
3500	         / unprotected: / {},
3501	         / payload: / null,
3502	         / signature: / h'\
3503	   B35BF8C5276ACF6131F4661E76A7F19945FF928A4B7D79572583E857C695DFD48725\
3504	           C1B8253EF6E805A9EEE9262CAAB61A09DF69CCBD996F2431BC2515EB59FF'
3505	       ]) >>
3506	     ] >>,
3507	     / manifest / 3: << {
3508	       / manifest-version / 1: 1,
3509	       / manifest-sequence-number / 2: 3,
3510	       / common / 3: << {
3511	         / components / 2: [
3512	           [
3513	              'TEEP-Device',
3514	              'SecureFS',
3515	             h'8D82573A926D4754935332DC29997F74', / tc-uuid /
3516	              'ta'
3517	           ]
3518	         ],
3519	         / shared-sequence / 4: << [
3520	           / directive-override-parameters / 20, {
3521	             / parameter-vendor-identifier / 1: h'\
3522	                                      C0DDD5F15243566087DB4F5B0AA26C2F',
3523	             / parameter-class-identifier / 2: h'\
3524	                                      DB42F7093D8C55BAA8C5265FC5820F4E',
3525	             / parameter-image-digest / 3: << [
3526	               / digest-algorithm-id: / -16 / SHA256 /,
3527	               / digest-bytes: / h'\
3528	       8CF71AC86AF31BE184EC7A05A411A8C3A14FD9B77A30D046397481469468ECE8'
3529	             ] >>,
3530	             / parameter-image-size / 14: 20
3531	           },
3532	           / condition-vendor-identifier / 1, 15,
3533	           / condition-class-identifier / 2, 15
3534	         ] >>
3535	       } >>,
3536	       / manifest-component-id / 5: [
3537	          'TEEP-Device',
3538	          'SecureFS',
3539	         h'8D82573A926D4754935332DC29997F74',  / tc-uuid /
3540	          'suit'
3541	       ],
3542	       / install / 20: << [
3543	         / directive-override-parameters / 20, {
3544	           / parameter-uri / 21: "https://example.org/8d82573a-926d-\
3545	                                              4754-9353-32dc29997f74.ta"
3546	         },
3547	         / directive-fetch / 21, 15,
3548	         / condition-image-match / 3, 15
3549	       ] >>,
3550	       / uninstall / 24: << [
3551	         / directive-unlink / 33, 15
3552	       ] >>
3553	     } >>
3554	   }

3556	CBOR Binary in Hex

3558	   A2025873825824822F5820B39B52B0B747EA79588C190F567BFC2C8437BA
3559	   8A73F7EA983182E79F0148D59B584AD28443A10128A0F65840B35BF8C527
3560	   6ACF6131F4661E76A7F19945FF928A4B7D79572583E857C695DFD48725C1
3561	   B8253EF6E805A9EEE9262CAAB61A09DF69CCBD996F2431BC2515EB59FF03
3562	   590108A601010203035884A20281844B544545502D446576696365485365
3563	   637572654653508D82573A926D4754935332DC29997F7442746104585486
3564	   14A40150C0DDD5F15243566087DB4F5B0AA26C2F0250DB42F7093D8C55BA
3565	   A8C5265FC5820F4E035824822F58208CF71AC86AF31BE184EC7A05A411A8
3566	   C3A14FD9B77A30D046397481469468ECE80E14010F020F05844B54454550
3567	   2D446576696365485365637572654653508D82573A926D4754935332DC29
3568	   997F7444737569741458458614A115783B68747470733A2F2F6578616D70
3569	   6C652E6F72672F38643832353733612D393236642D343735342D39333533
3570	   2D3332646332393939376637342E7461150F030F1818448218210F

3572	Example 2: SUIT Manifest including the Trusted Component Binary

3574	CBOR Diagnostic Notation of SUIT Manifest

3576	   =============== NOTE: '\' line wrapping per RFC 8792 ================

3578	   / SUIT_Envelope / {
3579	     / authentication-wrapper / 2: << [
3580	       << [
3581	         / digest-algorithm-id: / -16 / SHA256 /,
3582	         / digest-bytes: / h'\
3583	       CEDB0457952F7DD0A33FA4692F73BC833A6A6E2300B16F6605993F0192E3F219'
3584	       ] >>,
3585	       << / COSE_Sign1_Tagged / 18([
3586	         / protected: / << {
3587	           / algorithm-id / 1: -9 / ESP256 /
3588	         } >>,
3589	         / unprotected: / {},
3590	         / payload: / null,
3591	         / signature: / h'\
3592	   6A9F4D3DE3B8BC49A47F12E13A3EF76C5E2B4BB1D8EE6EFFA659220A6D8D164B3926\
3593	           A722220283A9C7B48DA012A188F0C6F98F3962613E63CD4C597D4C01F56C'
3594	       ]) >>
3595	     ] >>,
3596	     / manifest / 3: << {
3597	       / manifest-version / 1: 1,
3598	       / manifest-sequence-number / 2: 3,
3599	       / common / 3: << {
3600	         / components / 2: [
3601	           [
3602	              'TEEP-Device',
3603	              'SecureFS',
3604	             h'8D82573A926D4754935332DC29997F74', / tc-uuid /
3605	              'ta'
3606	           ]
3607	         ],
3608	         / shared-sequence / 4: << [
3609	           / directive-override-parameters / 20, {
3610	             / parameter-vendor-identifier / 1: h'\
3611	                                      C0DDD5F15243566087DB4F5B0AA26C2F',
3612	             / parameter-class-identifier / 2: h'\
3613	                                      DB42F7093D8C55BAA8C5265FC5820F4E',
3614	             / parameter-image-digest / 3: << [
3615	               / digest-algorithm-id: / -16 / SHA256 /,
3616	               / digest-bytes: / h'\
3617	       8CF71AC86AF31BE184EC7A05A411A8C3A14FD9B77A30D046397481469468ECE8'
3618	             ] >>,
3619	             / parameter-image-size / 14: 20
3620	           },
3621	           / condition-vendor-identifier / 1, 15,
3622	           / condition-class-identifier / 2, 15
3623	         ] >>
3624	       } >>,
3625	       / manifest-component-id / 5: [
3626	          'TEEP-Device',
3627	          'SecureFS',
3628	         h'8D82573A926D4754935332DC29997F74',  / tc-uuid /
3629	          'suit'
3630	       ],
3631	       / install / 20: << [
3632	         / directive-override-parameters / 20, {
3633	           / uri / 21: "#tc"
3634	         },
3635	         / directive-fetch / 21, 15,
3636	         / condition-image-match / 3, 15
3637	       ] >>,
3638	       / uninstall / 24: << [
3639	         / directive-unlink / 33, 15
3640	       ] >>

3642	     } >>,
3643	     "#tc" : 'Hello, Secure World!'
3644	   }

3646	CBOR Binary in Hex

3648	   A3025873825824822F5820CEDB0457952F7DD0A33FA4692F73BC833A6A6E
3649	   2300B16F6605993F0192E3F219584AD28443A10128A0F658406A9F4D3DE3
3650	   B8BC49A47F12E13A3EF76C5E2B4BB1D8EE6EFFA659220A6D8D164B3926A7
3651	   22220283A9C7B48DA012A188F0C6F98F3962613E63CD4C597D4C01F56C03
3652	   58CEA601010203035884A20281844B544545502D44657669636548536563
3653	   7572654653508D82573A926D4754935332DC29997F744274610458548614
3654	   A40150C0DDD5F15243566087DB4F5B0AA26C2F0250DB42F7093D8C55BAA8
3655	   C5265FC5820F4E035824822F58208CF71AC86AF31BE184EC7A05A411A8C3
3656	   A14FD9B77A30D046397481469468ECE80E14010F020F05844B544545502D
3657	   446576696365485365637572654653508D82573A926D4754935332DC2999
3658	   7F744473756974144C8614A11563237463150F030F1818448218210F6323
3659	   74635448656C6C6F2C2053656375726520576F726C6421

3661	Example 3: Supplying Personalization Data for Trusted Component Binary

3663	   This example uses the following parameters:

3665	   *  SUIT Profile: suit-sha256-esp256-ecdh-a128ctr (see
3666	      [I-D.ietf-suit-mti] Section 3.2)

3668	      -  Algorithm for payload encryption: A128CTR (-65534)

3670	      -  Algorithm for key wrap: ECDH-ES + A128KW (-29)

3672	   *  KEK (Receiver's Private Key):

3674	      -  kty: EC2

3676	      -  crv: P-256

3678	      -  x: h'5886CD61DD875862E5AAA820E7A15274
3679	         C968A9BC96048DDCACE32F50C3651BA3'

3681	      -  y: h'9EED8125E932CD60C0EAD3650D0A485C
3682	         F726D378D1B016ED4298B2961E258F1B'

3684	      -  d: h'60FE6DD6D85D5740A5349B6F91267EEA
3685	         C5BA81B8CB53EE249E4B4EB102C476B3'

3687	   *  COSE_KDF_Context

3689	      -  AlgorithmID: -3 (A128KW)
3690	      -  SuppPubInfo

3692	         o  keyDataLength: 128

3694	         o  protected: << {/ alg / 1: -29 / ECDH-ES+A128KW / } >>

3696	         o  other: 'SUIT Payload Encryption'

3698	CBOR Diagnostic Notation of SUIT Manifest

3700	   =============== NOTE: '\' line wrapping per RFC 8792 ================

3702	   / SUIT_Envelope / {
3703	     / authentication-wrapper / 2: << [
3704	       << [
3705	         / digest-algorithm-id: / -16 / SHA256 /,
3706	         / digest-bytes: / h'\
3707	       506D4796D65AE599EE0A3F7D123ED6819E0FA1A324A5DE547F6D7F50D465508A'
3708	       ] >>,
3709	       << / COSE_Sign1_Tagged / 18([
3710	         / protected: / << {
3711	           / algorithm-id / 1: -9 / ESP256 /
3712	         } >>,
3713	         / unprotected: / {},
3714	         / payload: / null,
3715	         / signature: / h'\
3716	   9AF4896B66B0642122C5317D1D8A81BB4CE3C0B022A7A53879224BA14AE954DE456D\
3717	           01069DEF0B5CE2E6B0325ACF21B5059320ABBA8480602C8A6FD7BF7894FF'
3718	       ]) >>
3719	     ] >>,
3720	     / manifest / 3: << {
3721	       / manifest-version / 1: 1,
3722	       / manifest-sequence-number / 2: 3,
3723	       / common / 3: << {
3724	         / dependencies / 1: {
3725	           / component-index / 1: {
3726	             / dependency-prefix / 1: [
3727	                'TEEP-Device',
3728	                'SecureFS',
3729	               h'8D82573A926D4754935332DC29997F74', / tc-uuid /
3730	                'suit'
3731	             ]
3732	           }
3733	         },
3734	         / components / 2: [
3735	           [
3736	             'TEEP-Device',
3737	             'SecureFS',
3738	             'config.json'
3739	           ]
3740	         ],
3741	         / shared-sequence / 4: << [
3742	           / directive-set-component-index / 12, 0,
3743	           / directive-override-parameters / 20, {
3744	             / parameter-vendor-identifier / 1: h'\
3745	                                      C0DDD5F15243566087DB4F5B0AA26C2F',
3746	             / parameter-class-identifier / 2: h'\
3747	                                       DB42F7093D8C55BAA8C5265FC5820F4E'
3748	           },
3749	           / condition-vendor-identifier / 1, 15,
3750	           / condition-class-identifier / 2, 15
3751	         ] >>
3752	       } >>,
3753	       / manifest-component-id / 5: [
3754	         'TEEP-Device',
3755	         'SecureFS',
3756	         'config.suit'
3757	       ],
3758	       / validate / 7: << [
3759	         / directive-set-component-index / 12, 0,
3760	         / directive-override-parameters / 20, {
3761	           / NOTE: image-digest and image-size of plaintext config.\
3762	                                                                  json /
3763	           / parameter-image-digest / 3: << [
3764	             / digest-algorithm-id: / -16 / SHA256 /,
3765	             / digest-bytes: / h'\
3766	       8273468FB64BD84BB04825F8371744D952B751C73A60F455AF681E167726F116'
3767	           ] >>,
3768	           / image-size / 14: 61
3769	         },
3770	         / condition-image-match / 3, 15
3771	       ] >>,
3772	       / dependency-resolution / 15: << [
3773	         / directive-set-component-index / 12, 1,
3774	         / directive-override-parameters / 20, {
3775	           / parameter-image-digest / 3: << [
3776	             / algorithm-id / -16 / SHA256 /,
3777	             / digest-bytes / h'\
3778	       B39B52B0B747EA79588C190F567BFC2C8437BA8A73F7EA983182E79F0148D59B'
3779	           ] >>,
3780	           / parameter-image-size / 14: 389,
3781	           / parameter-uri / 21: "https://example.org/8d82573a-926d-\
3782	                                            4754-9353-32dc29997f74.suit"
3783	         },
3784	         / directive-fetch / 21, 2
3785	       ] >>,
3786	       / install / 20: << [
3787	         / directive-set-component-index / 12, 1,
3788	         / directive-process-dependency / 11, 0,

3790	         / NOTE: fetch encrypted firmware /
3791	         / directive-set-component-index / 12, 0,
3792	         / directive-override-parameters / 20, {
3793	           / NOTE: encrypted payload and encryption-info /
3794	           / parameter-content / 18: h'\
3795	   6D5BE4F569E98AE01F38B071EF025437B742FF28854AB32C868BC6A76CD33B5CA112\
3796	                FF22BA95EA4672B7199C89A7829183794A21A6BE345C4371DCB0DC',
3797	           / parameter-encryption-info / 19: << 96([
3798	             / protected: / h'',
3799	             / unprotected: / {
3800	               / alg / 1: -65534 / A128CTR /,
3801	               / IV / 5: h'67E3BA7CD42D02BBC39C508B5EA0F1C4'
3802	             },
3803	             / payload: / null / detached ciphertext /,
3804	             / recipients: / [
3805	               [
3806	                 / protected: / << {
3807	                   / alg / 1: -29 / ECDH-ES + A128KW /
3808	                 } >>,
3809	                 / unprotected: / {
3810	                   / ephemeral key / -1: {
3811	                     / kty / 1: 2 / EC2 /,
3812	                     / crv / -1: 1 / P-256 /,
3813	                     / x / -2: h'\
3814	      F2452399667F57993B14C5F1107F667884854C190894FC08531C1E2290A7BA19',
3815	                     / y / -3: h'\
3816	       275EDDE29FD75C9393AFFA706F8FAD3C49D03D67D47F8B0C027BE5F0BCA884CB'
3817	                   }
3818	                 },
3819	                 / payload: / h'\
3820	                       7D806DA1ACEC6F704D803F0CFE7420525C81E1957699FCCE'
3821	               ]
3822	             ]
3823	           ]) >>
3824	         },

3826	         / decrypt encrypted firmware /
3827	         / directive-write / 18, 15 / consumes the \
3828	                                            SUIT_Encryption_Info above /
3829	         / NOTE: decrypted payload would be ``{"name":"FOO Bar","secret\
3830	                                ":"0123456789abfcdef0123456789abcd"}'' /
3831	       ] >>,
3832	       / uninstall / 24: << [
3833	         / directive-set-component-index / 12, 1,
3834	         / directive-process-dependency / 11, 0,
3835	         / directive-set-component-index / 12, 0,
3836	         / directive-unlink / 33, 15
3837	       ] >>
3838	     } >>
3839	   }

3841	CBOR Binary in Hex

3843	   A2025873825824822F5820506D4796D65AE599EE0A3F7D123ED6819E0FA1
3844	   A324A5DE547F6D7F50D465508A584AD28443A10128A0F658409AF4896B66
3845	   B0642122C5317D1D8A81BB4CE3C0B022A7A53879224BA14AE954DE456D01
3846	   069DEF0B5CE2E6B0325ACF21B5059320ABBA8480602C8A6FD7BF7894FF03
3847	   590242A801010203035886A301A101A101844B544545502D446576696365
3848	   485365637572654653508D82573A926D4754935332DC29997F7444737569
3849	   740281834B544545502D4465766963654853656375726546534B636F6E66
3850	   69672E6A736F6E04582D880C0014A20150C0DDD5F15243566087DB4F5B0A
3851	   A26C2F0250DB42F7093D8C55BAA8C5265FC5820F4E010F020F05834B5445
3852	   45502D4465766963654853656375726546534B636F6E6669672E73756974
3853	   075831860C0014A2035824822F58208273468FB64BD84BB04825F8371744
3854	   D952B751C73A60F455AF681E167726F1160E183D030F0F5872860C0114A3
3855	   035824822F5820B39B52B0B747EA79588C190F567BFC2C8437BA8A73F7EA
3856	   983182E79F0148D59B0E19018515783D68747470733A2F2F6578616D706C
3857	   652E6F72672F38643832353733612D393236642D343735342D393335332D
3858	   3332646332393939376637342E7375697415021458D88A0C010B000C0014
3859	   A212583D6D5BE4F569E98AE01F38B071EF025437B742FF28854AB32C868B
3860	   C6A76CD33B5CA112FF22BA95EA4672B7199C89A7829183794A21A6BE345C
3861	   4371DCB0DC13588AD8608440A20139FFFD055067E3BA7CD42D02BBC39C50
3862	   8B5EA0F1C4F6818344A101381CA120A401022001215820F2452399667F57
3863	   993B14C5F1107F667884854C190894FC08531C1E2290A7BA19225820275E
3864	   DDE29FD75C9393AFFA706F8FAD3C49D03D67D47F8B0C027BE5F0BCA884CB
3865	   58187D806DA1ACEC6F704D803F0CFE7420525C81E1957699FCCE120F1818
3866	   4A880C010B000C0018210F

3868	F.  Examples of SUIT Reports

3870	   This section shows some examples of SUIT reports.

3872	F.1.  Example 1: Success

3874	   SUIT Reports have no records if no conditions have failed.  The URI
3875	   in this example is the reference URI provided in the SUIT manifest.

3877	   {
3878	     / suit-report-manifest-digest / 1:<<[
3879	       / algorithm-id / -16 / "sha256" /,
3880	       / digest-bytes / h'a7fd6593eac32eb4be578278e6540c5c'
3881	                        h'09cfd7d4d234973054833b2b93030609'
3882	     ]>>,
3883	     / suit-report-manifest-uri / 2: "tam.teep.example/personalisation",
3884	     / suit-report-records / 4: []
3885	   }

3887	F.2.  Example 2: Failure

3889	  {
3890	    / suit-report-manifest-digest / 1:<<[
3891	      / algorithm-id / -16 / "sha256" /,
3892	      / digest-bytes / h'a7fd6593eac32eb4be578278e6540c5c09cfd7d4d23497
3893	  3054833b2b93030609'
3894	    ]>>,
3895	    / suit-report-manifest-uri / 2: "tam.teep.example/personalisation",
3896	    / suit-report-records / 4: [
3897	      {
3898	        / suit-record-manifest-id / 1:[],
3899	        / suit-record-manifest-section / 2: 7 / dependency-resolution /,
3900	        / suit-record-section-offset / 3: 66,
3901	        / suit-record-dependency-index / 5: 0,
3902	        / suit-record-failure-reason / 6: 404
3903	      }
3904	    ]
3905	  }

3907	   where the dependency-resolution refers to:

3909	   {
3910	     authentication-wrapper,
3911	     / manifest / 3:<<{
3912	       / manifest-version / 1:1,
3913	       / manifest-sequence-number / 2:3,
3914	       common,
3915	       dependency-resolution,
3916	       install,
3917	       validate,
3918	       run,
3919	       text
3920	     }>>,
3921	   }

3923	   and the suit-record-section-offset refers to:

3925	   <<[
3926	     / directive-set-dependency-index / 13,0,
3927	     / directive-set-parameters / 19,{
3928	       / uri / 21:'tam.teep.example/'
3929	                  'edd94cd8-9d9c-4cc8-9216-b3ad5a2d5b8a',
3930	       } ,
3931	     / directive-fetch / 21,2,
3932	     / condition-image-match / 3,15
3933	   ]>>,

3935	Authors' Addresses

3937	   Hannes Tschofenig
3938	   University of Applied Sciences Bonn-Rhein-Sieg
3939	   Germany
3940	   Email: hannes.tschofenig@gmx.net

3942	   Mingliang Pei
3943	   Broadcom
3944	   United States of America
3945	   Email: mingliang.pei@broadcom.com

3947	   David Wheeler
3948	   Amazon
3949	   United States of America
3950	   Email: davewhee@amazon.com

3952	   Dave Thaler
3953	   Microsoft
3954	   United States of America
3955	   Email: dave.thaler.ietf@gmail.com

3957	   Akira Tsukamoto
3958	   Openchip & Software Technologies, S.L.
3959	   Spain
3960	   Email: akira.tsukamoto@gmail.com









